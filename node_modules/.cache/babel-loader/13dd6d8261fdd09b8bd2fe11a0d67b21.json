{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\n// import DatePicker\nimport NextDatePicker from \"vue-datepicker-next\";\nimport \"vue-datepicker-next/index.css\";\nimport \"vue-datepicker-next/locale/vi\"; //multi vue 3\n\nimport vMultiselect from \"@vueform/multiselect\";\nimport \"@vueform/multiselect/themes/default.css\";\nimport UserAPI from '@/api/UserAPI';\nimport BaseDictionaryDetail from \"@/views/base/BaseDictionaryDetail.vue\";\nexport default {\n  name: \"MSDialogDetail\",\n  extends: BaseDictionaryDetail,\n  emits: [\"showDialog\", \"loadData\", \"eShowPopup\", \"eCloseDialog\"],\n  components: {\n    \"v-date-picker\": NextDatePicker,\n\n    /* eslint-disable vue/no-unused-components */\n    \"v-multiselect\": vMultiselect\n  },\n  props: {\n    // isShow: {\n    //   type: Boolean,\n    //   default: false,\n    // },\n    employeeSelected: {},\n    //currentItem đang thao tác\n    isShowDialog: {\n      type: Boolean,\n      default: false\n    },\n    formMode: {\n      //trạng thái của form là gì\n      type: Number,\n      default: 1\n    }\n  },\n\n  data() {\n    return {\n      isShow: false,\n      // trạng thái ẩn hiện của form\n      editMode: 'Add',\n      //trạng thái form\n      isViewing: false,\n      //mode view\n      //có đang thêm nhiều không?\n      isMultiAdd: false,\n      //dữ liệu có bị thay đổi không?\n      isChange: false,\n      listInputError: [],\n      currentItem: {},\n      employeeInit: {\n        gender: null\n      },\n      //new employeeId truyền vào dialog\n      newEmployeeCode: null,\n      //danh sách các phòng ban nhận từ server\n      departments: {},\n      //danh sách các phòng ban truyền vào combobox: title và value      \n      departmentValue: null //giá trị của combobox department\n\n    };\n  },\n\n  created() {\n    this.initStaticData();\n  },\n\n  methods: {\n    /**\r\n    * hàm xử lý bind data lên form từ màn hình danh sách\r\n    * @created : quyetkaito 06/10/2022\r\n    * @param {Object} object  đối tượng truyền từ ngoài danh sách vào\r\n    * @param {String} editMode : xác định là xem hay sửa..\r\n    */\n    bindData(object, editMode) {\n      let me = this;\n\n      if (object) {\n        if (editMode) {\n          me.editMode = editMode;\n\n          if (editMode == 'View') {\n            me.isViewing = true;\n          }\n        } //còn đoạn xử lý datetime các kiểu\n\n\n        me.currentItem = object;\n        me.originalItem = JSON.parse(JSON.stringify(me.currentItem));\n      }\n    },\n\n    /**\r\n    * Xử lý khi email thay đổi\r\n    * @created : quyetkaito 05/10/2022\r\n    */\n    emailChange() {\n      let me = this;\n\n      if (me.currentItem) {\n        if (me.currentItem.email) {\n          if (!me.$commonFunc.validateEmail(me.currentItem.email)) {\n            // me.$store.commit(\"showError\", {\n            //     message: \"Email không hợp lệ.\",\n            // });\n            if (me.$refs.email && typeof me.$refs.email.setTooltip == \"function\") {\n              me.$refs.email.setErrorTooltip(\"Email không đúng định dạng.\");\n            }\n\n            if (me.$refs.email && typeof me.$refs.email.focus == 'function') {\n              me.$refs.email.focus();\n              me.$refs.email.addRedBorder();\n            }\n          } //gán username theo \n\n\n          me.currentItem.username = me.currentItem.email.split('@')[0];\n        } else {\n          //thông báo ko được để trống\n          if (me.$refs.email && typeof me.$refs.email.focus == 'function') {\n            me.$refs.email.focus();\n\n            if (typeof me.$refs.email.addError == 'function') {\n              me.$refs.email.addError();\n            }\n          }\n        }\n      }\n    },\n\n    /**\r\n    * hàm khởi tạo biến tĩnh\r\n    * @created : quyetkaito 04/10/2022\r\n    */\n    initStaticData() {\n      let me = this;\n      me.formTitle = me.$t('UserDetail'); //title của form.\n\n      me.langString = \"vi\"; //ngôn ngữ cho datepicker\n\n      me.dateFormat = \"DD/MM/YYYY\";\n      me.storeUserRole = [{\n        label: \"Admin\",\n        value: 0\n      }, {\n        label: \"User\",\n        value: 1\n      }];\n    },\n\n    initNewItem() {\n      let me = this;\n      me.currentItem.password = \"Abc@12345678\"; //random pasword\n\n      me.currentItem.role = 1; //mặc định là thêm người dùng\n    },\n\n    /**\r\n    * hàm xử lý sự kiện cho các button\r\n    * @created : quyetkaito 04/10/2022\r\n    */\n    buttonClick(action) {\n      let me = this;\n\n      switch (action) {\n        case 'Close':\n        case 'Cancel':\n          me.hide();\n          break;\n\n        case 'Save':\n          me.save();\n          break;\n\n        case 'Edit':\n          me.edit();\n          break;\n\n        default:\n          break;\n      }\n    },\n\n    edit() {\n      let me = this;\n      this.editMode = 'Edit';\n      this.isViewing = false; // focus vào ô đầu tiên \n\n      if (me.$refs.email && typeof me.$refs.email.focus == \"function\") {\n        me.$refs.email.focus();\n      }\n    },\n\n    /**\r\n    * hàm xử lý cất dữ liệu\r\n    * @created : quyetkaito 05/10/2022\r\n    * @param {Boolean}  isClose : có đóng form sau khi cất hay không\r\n    */\n    async save(isClose) {\n      let me = this;\n      if (!(await me.validate())) return; //build object\n\n      let obj = me.prepareDataBeforeSave();\n\n      if (obj) {\n        me.$commonFunc.load();\n\n        try {\n          let method = 'POST';\n          if (me.editMode == 'Edit') method = 'PUT';\n          await UserAPI.request(UserAPI.urlName, method, obj).then(res => {\n            console.log(`res:`, res.data);\n\n            if (res && res.data && res.data.Data) {\n              if (res.data.StatusCode == 201) {\n                me.$store.commit(\"showSuccess\", {\n                  message: \"Thêm mới thành công.\"\n                });\n              } else if (res.data.StatusCode == 200) {\n                me.$store.commit(\"showSuccess\", {\n                  message: \"Thành công.\"\n                });\n              } else if (![200, 201].includes(res.data.StatusCode)) {\n                me.handleException(res);\n              }\n\n              if (isClose != false) {\n                this.isShow = false; //ẩn form\n                //gọi parent reload lại danh sách\n\n                this.$parent.buttonClick('Refresh');\n              }\n            } else {\n              me.handleException(res);\n            }\n\n            me.$commonFunc.unload();\n          });\n        } catch (error) {\n          me.handleException(error);\n        }\n      }\n    },\n\n    async validate() {\n      let me = this;\n      if (!(await me.validateComponent()) || !(await me.validateBusiness())) return false;\n      return true;\n    },\n\n    async validateComponent() {\n      let me = this; //validate bỏ trống\n\n      let valid = true;\n      let listError = []; //chứa các refs input để tí focus hoặc gọi hàm trong MInput\n\n      let message = \"\";\n\n      if (me.currentItem) {\n        if (!me.currentItem.email) {\n          listError.push(\"email\");\n          valid = false;\n        }\n\n        if (!me.currentItem.full_name) {\n          listError.push(\"fullname\");\n          valid = false;\n        }\n\n        if (!me.currentItem.password) {\n          listError.push(\"password\");\n          valid = false;\n        }\n      }\n\n      if (listError && listError.length > 0) {\n        //set error đỏ cho các ô input\n        for (let i = 0; i < listError.length; i++) {\n          if (me.$refs[listError[i]] && typeof me.$refs[listError[i]].addError == \"function\") {\n            me.$refs[listError[i]].addError();\n          }\n        }\n\n        if (typeof me.$refs[listError[0]].getTitle == \"function\") {\n          message = me.$refs[listError[0]].getTitle() + \" không được bỏ trống.\";\n        } //show message\n\n\n        me.$store.commit(\"showError\", {\n          message: message\n        });\n        me.focusAfterValidate(listError[0]);\n      }\n\n      return valid; //validate email       \n    },\n\n    /**\r\n    * Hàm focus vào ô input khi validate có lỗi\r\n    * @created : quyetkaito 05/10/2022\r\n    */\n    focusAfterValidate(ref) {\n      let me = this;\n\n      if (ref && me.$refs[ref] && typeof me.$refs[ref].focus == \"function\") {\n        me.$refs[ref].focus();\n\n        if (typeof me.$refs[ref].addError == 'function') {\n          me.$refs[ref].addError();\n        }\n      }\n    },\n\n    /**\r\n    * Validate nghiệp vụ khác\r\n    * @created : quyetkaito 06/10/2022\r\n    */\n    async validateBusiness() {\n      let me = this; //validate trùng email/username\n\n      if (!me.$commonFunc.validateEmail(me.currentItem.email)) {\n        me.$store.commit(\"showError\", {\n          message: \"Email không hợp lệ.\"\n        });\n        me.focusAfterValidate(\"email\");\n        return false;\n      }\n\n      return true;\n    },\n\n    prepareDataBeforeSave() {\n      let me = this;\n\n      if (me.currentItem) {\n        return me.currentItem;\n      }\n    },\n\n    hide() {\n      let me = this;\n      me.beforeHide();\n      this.isShow = false;\n      me.afterHide();\n    },\n\n    beforeHide() {\n      //kiểm tra thay đổi các kiểu\n      let me = this;\n\n      if (me.isDeepEqual(me.originalItem, me.currentItem)) {\n        console.log(`ko có thay đổi`);\n      } else {\n        if (confirm(\"Dữ liệu đã bị thay đổi. Bạn có muốn lưu không?\")) {\n          console.log(\"Có lưu\");\n        }\n      }\n    },\n\n    afterHide() {\n      this.currentItem = {};\n      this.isViewing = false;\n    },\n\n    /**\r\n    * hiện form lên\r\n    * @created : quyetkaito 04/10/2022\r\n    */\n    show(editMode) {\n      let me = this;\n      this.isShow = true;\n\n      if (editMode == 'Add') {\n        me.initNewItem();\n        me.originalItem = JSON.parse(JSON.stringify(me.currentItem));\n      } //focus vào ô nhập liệu đầu tiên\n\n\n      if (editMode != 'View') {\n        if (this.$refs.email && typeof this.$refs.email.focus == \"function\") {\n          this.$refs.email.focus();\n        }\n      }\n    },\n\n    /**\r\n    * Không cho chọn ngày lớn hơn hiện tại\r\n    * @created : quyetkaito 04/10/2022\r\n    */\n    disabledDateBeforeToday(date) {\n      return date > new Date();\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["NextDatePicker","vMultiselect","UserAPI","BaseDictionaryDetail","name","extends","emits","components","props","employeeSelected","isShowDialog","type","Boolean","default","formMode","Number","data","isShow","editMode","isViewing","isMultiAdd","isChange","listInputError","currentItem","employeeInit","gender","newEmployeeCode","departments","departmentValue","created","initStaticData","methods","bindData","object","me","originalItem","JSON","parse","stringify","emailChange","email","$commonFunc","validateEmail","$refs","setTooltip","setErrorTooltip","focus","addRedBorder","username","split","addError","formTitle","$t","langString","dateFormat","storeUserRole","label","value","initNewItem","password","role","buttonClick","action","hide","save","edit","isClose","validate","obj","prepareDataBeforeSave","load","method","request","urlName","then","res","console","log","Data","StatusCode","$store","commit","message","includes","handleException","$parent","unload","error","validateComponent","validateBusiness","valid","listError","push","full_name","length","i","getTitle","focusAfterValidate","ref","beforeHide","afterHide","isDeepEqual","confirm","show","disabledDateBeforeToday","date","Date"],"sourceRoot":"","sources":["D:\\Traveller\\Traveller-Frontend\\traveller-ui\\src\\views\\user\\UserDetail.vue"],"sourcesContent":["<template>\r\n    <!-- Dialog thêm mới -->\r\n  <div class=\"m-popup m-add-popup\" v-bind:class=\"{ show: isShow }\" ref=\"dialog\">\r\n    <div class=\"m-popup-box h-625 w-800\">\r\n      <!-- Header -->\r\n      <div class=\"m-popup-header\">\r\n        <div class=\"m-popup-header__left\">\r\n          <div class=\"title-container\">\r\n            <div class=\"popup-title-text\">{{ formTitle }}</div>            \r\n          </div>\r\n        </div>\r\n        <div class=\"m-popup-header__right\">\r\n          <div style=\"position: relative\">\r\n            <div\r\n              class=\"m-icon m-icon-24 m-help__nav\"\r\n              style=\"margin-right: 6px\"\r\n            ></div>\r\n            <!-- <ms-tooltip class=\"hide\" text=\"Giúp (F1)\" :isTop=\"true\" /> -->\r\n          </div>\r\n          <div style=\"position: relative\">\r\n            <div class=\"m-icon m-icon-24 m-close\" @click=\"buttonClick('Close')\"></div>\r\n            <!-- <ms-tooltip class=\"hide\" text=\"Đóng (ESC)\" :isTop=\"true\" /> -->\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <!-- Header end-->\r\n      <!-- Form -->\r\n      <div class=\"m-popup-form\">\r\n        <!-- Detail -->\r\n        <div class=\"form-container\">\r\n          <div class=\"form-detail\">\r\n            <div class=\"general-info\">\r\n              <div class=\"info-left\">\r\n                <div class=\"m-form-field\">\r\n                  <div class=\"form-item\" style=\"width: 100%\">\r\n                    <m-input\r\n                      :labelText=\"$t('EmailLogin')\"\r\n                      v-model=\"currentItem.email\"\r\n                      required\r\n                      :readonly=\"isViewing\"\r\n                      :isAutoFocus=\"true\"\r\n                      :maxlength=\"20\"\r\n                      placeholder=\"\"\r\n                      :style=\"{ width: '100%' }\"\r\n                      ref=\"email\"\r\n                      @change=\"emailChange\"\r\n                    />\r\n                  </div>                  \r\n                </div>\r\n                <div class=\"m-form-field\">\r\n                    <div class=\"form-item\" style=\"width: 100%\">\r\n                        <m-input\r\n                            :labelText=\"$t('FullName')\"\r\n                            :maxlength=\"100\"\r\n                            required\r\n                            :readonly=\"isViewing\"\r\n                            v-model=\"currentItem.full_name\"\r\n                            placeholder=\"\"\r\n                            ref=\"fullname\"\r\n                        />\r\n                    </div>                 \r\n                </div>\r\n                <div class=\"m-form-field\">\r\n                    <div class=\"form-item\" style=\"padding-right: 6px; width: 100%\">\r\n                        <m-input\r\n                            :labelText=\"$t('UserName')\"                            \r\n                            :maxlength=\"50\"\r\n                            v-model=\"currentItem.username\"\r\n                            placeholder=\"\"\r\n                            ref=\"username\"\r\n                            disabled\r\n                        />\r\n                    </div>\r\n                    <div class=\"form-item\" style=\"width: 100%\">\r\n                        <m-input\r\n                            :labelText=\"$t('Password')\"                            \r\n                            :maxlength=\"50\"\r\n                            required\r\n                            :readonly=\"isViewing\"\r\n                            v-model=\"currentItem.password\"\r\n                            placeholder=\"\"\r\n                            ref=\"password\"\r\n                        />\r\n                    </div>\r\n                   <!-- <div class=\"form-item\" style=\"width: 100%\">\r\n                    <m-label text=\"Vai trò\" />                    \r\n                    <v-multiselect\r\n                    ref=\"department\"\r\n                      v-model=\"currentItem.role\"\r\n                      :options=\"storeUserRole\"\r\n                      label=\"label\"\r\n                      :close-on-select=\"true\"\r\n                      :clearOnSelect=\"true\"\r\n                      :searchable=\"true\"\r\n                      noResultsText=\"Không có dữ liệu hiển thị\"\r\n                      :disabled=\"false\"                      \r\n                      :canClear=\"false\"\r\n                      :canDeselect=\"false\"\r\n                    />\r\n                  </div> -->\r\n                </div>\r\n              </div>\r\n              <div class=\"info-right\">\r\n                <div class=\"m-form-field\">\r\n                  <div class=\"form-item\" style=\"padding-right: 6px; width: 40%\">\r\n                    <m-label text=\"Ngày sinh\" />\r\n                    <v-date-picker\r\n                      v-model:value=\"currentItem.date_of_birth\"\r\n                      :format=\"dateFormat\"\r\n                      :placeholder=\"dateFormat\"\r\n                      :lang=\"langString\"\r\n                      :disabled-date=\"disabledDateBeforeToday\"\r\n                      :clearable=\"false\"\r\n                      title-format=\"DD/MM/YYYY\"\r\n                    />\r\n                  </div>\r\n                  <div class=\"form-item\" style=\"width: 60%; padding-left: 6px\">\r\n                    <m-label text=\"Giới tính\" />\r\n                    <div class=\"m-row m-field-gender\">\r\n                      <m-radio v-model=\"currentItem.gender\" :value=\"1\" label=\"Nam\"/>\r\n                      <m-radio v-model=\"currentItem.gender\" :value=\"0\" label=\"Nữ\" />\r\n                      <m-radio v-model=\"currentItem.gender\" :value=\"2\" label=\"Khác\"/>                      \r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class=\"m-form-field\">\r\n                  <div class=\"form-item\" style=\"width: 100%\">\r\n                    <m-input\r\n                      :labelText=\"$t('PhoneNumber')\"\r\n                      :maxlength=\"25\"\r\n                      :readonly=\"isViewing\"\r\n                      v-model=\"currentItem.phone\"\r\n                      placeholder=\"\"\r\n                      ref=\"phoneNumber\"\r\n                    />\r\n                    </div>                  \r\n                </div>\r\n                <div class=\"m-form-field\">\r\n                  <div class=\"form-item\" style=\"width: 100%\">\r\n                    <m-label text=\"Vai trò\" />                    \r\n                    <v-multiselect\r\n                    ref=\"department\"\r\n                      v-model=\"currentItem.role\"\r\n                      :options=\"storeUserRole\"\r\n                      label=\"label\"\r\n                      :close-on-select=\"true\"\r\n                      :clearOnSelect=\"true\"\r\n                      :searchable=\"true\"\r\n                      noResultsText=\"Không có dữ liệu hiển thị\"\r\n                      :disabled=\"false\"                      \r\n                      :canClear=\"false\"\r\n                      :canDeselect=\"false\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"contact-info\">\r\n              <div class=\"m-form-field\">\r\n                <div class=\"form-item\" style=\"width: 100%\">\r\n                  <m-input\r\n                    labelText=\"Địa chỉ\"\r\n                    :maxlength=\"255\"\r\n                    :readonly=\"isViewing\"\r\n                    v-model=\"currentItem.address\"\r\n                    placeholder=\"\"\r\n                    :style=\"{ width: '100%' }\"\r\n                    ref=\"address\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div class=\"m-form-field\">                \r\n                <div class=\"form-item\">\r\n                  <m-input\r\n                    labelText=\"Trạng thái\"                    \r\n                    :maxlength=\"50\"\r\n                    :readonly=\"isViewing\"\r\n                    v-model=\"currentItem.status\"\r\n                    placeholder=\"\"\r\n                    ref=\"status\"\r\n                  />\r\n                </div>                \r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <!-- Detail end-->\r\n\r\n        <!-- Footer -->\r\n        <div class=\"footer-container\">\r\n          <div class=\"footer-line\">\r\n            <button class=\"m-btn-second\" @click=\"buttonClick('Cancel')\"> {{$t('Cancel')}}</button>\r\n            <div class=\"group-btn-popup align-right\" v-if=\"!isViewing\">\r\n              <div style=\"position: relative\">\r\n                <button\r\n                  class=\"m-btn-second btn-save\"\r\n                  @click=\"buttonClick('Save')\"                  \r\n                >\r\n                  {{$t('Save')}}\r\n                </button>\r\n                <!-- <ms-tooltip class=\"hide\" text=\"Cất (Ctrl + S)\" :isTop=\"false\" /> -->\r\n              </div>\r\n              <div style=\"position: relative\">\r\n                <button\r\n                  class=\"m-btn btn-multi-add tooltip\"\r\n                  style=\"margin-left: 16px\"\r\n                >\r\n                   {{$t('SaveAndAdd')}}\r\n                </button>\r\n                <!-- <ms-tooltip\r\n                  class=\"hide\"\r\n                  text=\"Cất và thêm (Ctrl + Shift + S)\"\r\n                  :isTop=\"false\"\r\n                /> -->\r\n              </div>\r\n            </div>\r\n            <div class=\"group-btn-popup align-right\" v-if=\"isViewing\">\r\n              <div style=\"position: relative\">\r\n                <button\r\n                  class=\"m-btn btn-save\"\r\n                  @click=\"buttonClick('Edit')\"                  \r\n                >\r\n                  {{$t('Edit')}}\r\n                </button>               \r\n              </div>              \r\n            </div>\r\n          </div>\r\n        </div>\r\n        <!-- Footer end-->\r\n      </div>\r\n      <!-- Form end -->\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// import DatePicker\r\nimport NextDatePicker from \"vue-datepicker-next\";\r\nimport \"vue-datepicker-next/index.css\";\r\nimport \"vue-datepicker-next/locale/vi\";\r\n\r\n//multi vue 3\r\nimport vMultiselect from \"@vueform/multiselect\";\r\nimport \"@vueform/multiselect/themes/default.css\";\r\n\r\nimport UserAPI from '@/api/UserAPI';\r\nimport BaseDictionaryDetail from \"@/views/base/BaseDictionaryDetail.vue\";\r\n\r\nexport default {\r\n  name: \"MSDialogDetail\",\r\n  extends: BaseDictionaryDetail,\r\n  emits: [\"showDialog\", \"loadData\", \"eShowPopup\", \"eCloseDialog\"],\r\n  components: {\r\n    \"v-date-picker\": NextDatePicker,\r\n    /* eslint-disable vue/no-unused-components */\r\n    \"v-multiselect\": vMultiselect,\r\n  },\r\n\r\n  props: {\r\n    // isShow: {\r\n    //   type: Boolean,\r\n    //   default: false,\r\n    // },\r\n    employeeSelected: {}, //currentItem đang thao tác\r\n    isShowDialog: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    formMode: {\r\n      //trạng thái của form là gì\r\n      type: Number,\r\n      default: 1,\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      isShow: false,// trạng thái ẩn hiện của form\r\n      editMode: 'Add', //trạng thái form\r\n      isViewing: false, //mode view\r\n      //có đang thêm nhiều không?\r\n      isMultiAdd: false,\r\n      //dữ liệu có bị thay đổi không?\r\n      isChange: false,\r\n      listInputError: [],\r\n      currentItem: {},\r\n      employeeInit: {gender:null,},\r\n      //new employeeId truyền vào dialog\r\n      newEmployeeCode: null,\r\n      //danh sách các phòng ban nhận từ server\r\n      departments: {},\r\n      //danh sách các phòng ban truyền vào combobox: title và value      \r\n      departmentValue: null, //giá trị của combobox department\r\n    };\r\n  },\r\n  created(){\r\n    this.initStaticData();\r\n  },\r\n  methods:{\r\n    /**\r\n    * hàm xử lý bind data lên form từ màn hình danh sách\r\n    * @created : quyetkaito 06/10/2022\r\n    * @param {Object} object  đối tượng truyền từ ngoài danh sách vào\r\n    * @param {String} editMode : xác định là xem hay sửa..\r\n    */\r\n    bindData(object, editMode){\r\n        let me = this;\r\n        if(object){\r\n            if(editMode){\r\n                me.editMode = editMode;   \r\n                if(editMode == 'View'){\r\n                    me.isViewing = true;\r\n                }             \r\n            }\r\n            //còn đoạn xử lý datetime các kiểu\r\n            me.currentItem = object;\r\n            me.originalItem = JSON.parse(JSON.stringify(me.currentItem));\r\n        }\r\n    },\r\n\r\n    /**\r\n    * Xử lý khi email thay đổi\r\n    * @created : quyetkaito 05/10/2022\r\n    */\r\n    emailChange(){\r\n        let me = this;\r\n        if(me.currentItem){\r\n            if(me.currentItem.email){\r\n                if(! me.$commonFunc.validateEmail(me.currentItem.email)){\r\n                    // me.$store.commit(\"showError\", {\r\n                    //     message: \"Email không hợp lệ.\",\r\n                    // });\r\n                    if(me.$refs.email && typeof me.$refs.email.setTooltip == \"function\"){\r\n                        me.$refs.email.setErrorTooltip(\"Email không đúng định dạng.\");\r\n                    }\r\n                    if(me.$refs.email && typeof me.$refs.email.focus == 'function'){\r\n                        me.$refs.email.focus();    \r\n                        me.$refs.email.addRedBorder();                          \r\n                    }\r\n                }\r\n                //gán username theo \r\n                me.currentItem.username = me.currentItem.email.split('@')[0];                \r\n            }else{\r\n                //thông báo ko được để trống\r\n                if(me.$refs.email && typeof me.$refs.email.focus == 'function'){\r\n                    me.$refs.email.focus();\r\n                    if(typeof me.$refs.email.addError == 'function'){\r\n                        me.$refs.email.addError();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    /**\r\n    * hàm khởi tạo biến tĩnh\r\n    * @created : quyetkaito 04/10/2022\r\n    */\r\n    initStaticData(){\r\n        let me = this;\r\n        me.formTitle = me.$t('UserDetail'); //title của form.\r\n        me.langString = \"vi\"; //ngôn ngữ cho datepicker\r\n        me.dateFormat = \"DD/MM/YYYY\";\r\n        me.storeUserRole = [\r\n            {\r\n                label: \"Admin\",\r\n                value: 0,\r\n            },\r\n            {\r\n                label: \"User\",\r\n                value: 1,\r\n            }\r\n\r\n        ]         \r\n    },\r\n\r\n    initNewItem(){\r\n        let me = this;\r\n        me.currentItem.password =  \"Abc@12345678\"; //random pasword\r\n        me.currentItem.role = 1; //mặc định là thêm người dùng\r\n    },\r\n\r\n    /**\r\n    * hàm xử lý sự kiện cho các button\r\n    * @created : quyetkaito 04/10/2022\r\n    */\r\n    buttonClick(action){\r\n        let me = this;\r\n        switch(action){\r\n            case 'Close':\r\n            case 'Cancel':\r\n                me.hide();\r\n                break;\r\n            case 'Save':\r\n                me.save();\r\n                break;\r\n            case 'Edit':\r\n                me.edit();\r\n                break;                \r\n            default:\r\n                break;            \r\n        }        \r\n    },\r\n    \r\n    edit(){\r\n        let me = this;\r\n        this.editMode = 'Edit';\r\n        this.isViewing = false;   \r\n        // focus vào ô đầu tiên \r\n        if(me.$refs.email && typeof me.$refs.email.focus == \"function\"){\r\n            me.$refs.email.focus();\r\n        }\r\n    },\r\n\r\n\r\n    /**\r\n    * hàm xử lý cất dữ liệu\r\n    * @created : quyetkaito 05/10/2022\r\n    * @param {Boolean}  isClose : có đóng form sau khi cất hay không\r\n    */\r\n    async save(isClose){\r\n        let me = this;\r\n        if(!await me.validate()) return;\r\n        //build object\r\n        let obj = me.prepareDataBeforeSave();\r\n        if(obj){\r\n            me.$commonFunc.load();\r\n            try {\r\n                let method = 'POST';\r\n                if(me.editMode == 'Edit') method = 'PUT';\r\n                await UserAPI.request(UserAPI.urlName, method, obj).then((res)=>{                    \r\n                    console.log(`res:`, res.data);\r\n                    if(res && res.data && res.data.Data){\r\n                        if(res.data.StatusCode == 201){\r\n                            me.$store.commit(\"showSuccess\", {\r\n                                message: \"Thêm mới thành công.\",\r\n                            });\r\n                        }else if(res.data.StatusCode == 200){\r\n                            me.$store.commit(\"showSuccess\", {\r\n                                message: \"Thành công.\",\r\n                            });\r\n                        }else if(![200, 201].includes(res.data.StatusCode)){\r\n                            me.handleException(res);\r\n                        }\r\n                        if(isClose != false){\r\n                            this.isShow = false; //ẩn form\r\n                            //gọi parent reload lại danh sách\r\n                            this.$parent.buttonClick('Refresh');\r\n                        }\r\n                    }else{\r\n                        me.handleException(res);                        \r\n                    }\r\n                    me.$commonFunc.unload();\r\n                })            \r\n            } catch (error) {\r\n                me.handleException(error);                \r\n            }\r\n            \r\n        }        \r\n    },\r\n\r\n    async validate(){\r\n        let me = this;\r\n        if(!await me.validateComponent() || !await me.validateBusiness()) return false;\r\n        return true;        \r\n    },\r\n\r\n    async validateComponent(){\r\n        let me = this;\r\n        //validate bỏ trống\r\n        let valid = true;\r\n        let listError = []; //chứa các refs input để tí focus hoặc gọi hàm trong MInput\r\n        let message = \"\";\r\n        if(me.currentItem){\r\n            if(!me.currentItem.email){\r\n                listError.push(\"email\");\r\n                valid = false;               \r\n            }\r\n            if(!me.currentItem.full_name){\r\n                listError.push(\"fullname\");\r\n                valid = false;                \r\n            }\r\n            if(!me.currentItem.password){\r\n                listError.push(\"password\");\r\n                valid = false;                \r\n            }\r\n            \r\n        }\r\n        if(listError && listError.length > 0){\r\n            //set error đỏ cho các ô input\r\n            for(let i = 0 ; i< listError.length ; i++){\r\n                if(me.$refs[listError[i]] && typeof me.$refs[listError[i]].addError == \"function\"){\r\n                    me.$refs[listError[i]].addError();\r\n                }\r\n            }\r\n            if(typeof me.$refs[listError[0]].getTitle == \"function\"){\r\n                message = me.$refs[listError[0]].getTitle() + \" không được bỏ trống.\";\r\n            }\r\n            //show message\r\n            me.$store.commit(\"showError\", {\r\n                message: message,\r\n            });\r\n            me.focusAfterValidate(listError[0]);\r\n        }\r\n        return valid;\r\n        //validate email       \r\n    },\r\n\r\n    /**\r\n    * Hàm focus vào ô input khi validate có lỗi\r\n    * @created : quyetkaito 05/10/2022\r\n    */\r\n    focusAfterValidate(ref){\r\n        let me = this;        \r\n        if(ref && me.$refs[ref] && typeof me.$refs[ref].focus == \"function\"){\r\n            me.$refs[ref].focus();\r\n            if(typeof me.$refs[ref].addError == 'function'){\r\n                me.$refs[ref].addError();\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n    * Validate nghiệp vụ khác\r\n    * @created : quyetkaito 06/10/2022\r\n    */\r\n    async validateBusiness(){\r\n        let me = this;\r\n        //validate trùng email/username\r\n        if(! me.$commonFunc.validateEmail(me.currentItem.email)){               \r\n            me.$store.commit(\"showError\", {\r\n                message: \"Email không hợp lệ.\",\r\n            });\r\n            me.focusAfterValidate(\"email\");         \r\n            return false;           \r\n        }\r\n        return true;\r\n    },\r\n\r\n    prepareDataBeforeSave(){\r\n        let me = this;\r\n        if(me.currentItem){\r\n            return me.currentItem;\r\n        }\r\n    },\r\n\r\n    hide(){\r\n        let me = this;\r\n        me.beforeHide();\r\n        this.isShow = false;\r\n        me.afterHide();\r\n    },\r\n\r\n    beforeHide(){\r\n        //kiểm tra thay đổi các kiểu\r\n        let me = this;\r\n        if(me.isDeepEqual(me.originalItem, me.currentItem)){\r\n            console.log(`ko có thay đổi`);\r\n        }else{\r\n            if(confirm(\"Dữ liệu đã bị thay đổi. Bạn có muốn lưu không?\")){\r\n                console.log(\"Có lưu\");\r\n            }\r\n        }\r\n    },\r\n\r\n    afterHide(){        \r\n        this.currentItem = {};\r\n        this.isViewing = false;\r\n    },\r\n    \r\n    /**\r\n    * hiện form lên\r\n    * @created : quyetkaito 04/10/2022\r\n    */\r\n    show(editMode){\r\n        let me = this;\r\n        this.isShow = true;       \r\n        if(editMode == 'Add'){\r\n            me.initNewItem();\r\n            me.originalItem = JSON.parse(JSON.stringify(me.currentItem));\r\n        } \r\n        //focus vào ô nhập liệu đầu tiên\r\n        if(editMode != 'View'){\r\n            if(this.$refs.email && typeof this.$refs.email.focus == \"function\"){\r\n                this.$refs.email.focus();\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n    * Không cho chọn ngày lớn hơn hiện tại\r\n    * @created : quyetkaito 04/10/2022\r\n    */\r\n    disabledDateBeforeToday(date ){\r\n        return date > new Date();\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style>\r\n@import url(\"/src/style/common/dialog.css\");\r\n@import url(\"/src/style/common/custom-datepicker.css\");\r\n@import url(\"/src/style/page/employee-dialog.css\");\r\n.error{\r\n  border-color: var(--danger-color)!important;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}
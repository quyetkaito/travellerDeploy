{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withKeys as _withKeys, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, createBlock as _createBlock, normalizeClass as _normalizeClass, Fragment as _Fragment, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-13ca1316\"), n = n(), _popScopeId(), n);\n\nconst _hoisted_1 = {\n  class: \"m-popup-box\"\n};\nconst _hoisted_2 = {\n  class: \"m-popup-header\"\n};\nconst _hoisted_3 = {\n  class: \"popup-title-text\"\n};\nconst _hoisted_4 = {\n  class: \"m-popup-body\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"form-container\"\n};\nconst _hoisted_6 = {\n  key: 1,\n  class: \"form-container\"\n};\nconst _hoisted_7 = {\n  key: 0,\n  class: \"quick-add-action\"\n};\n\nconst _hoisted_8 = /*#__PURE__*/_createTextVNode(\"Không tìm thấy danh mục? \");\n\nconst _hoisted_9 = {\n  class: \"footer-container flex-grow\"\n};\nconst _hoisted_10 = {\n  class: \"footer-line\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_m_input = _resolveComponent(\"m-input\");\n\n  const _component_m_label = _resolveComponent(\"m-label\");\n\n  const _component_v_multiselect = _resolveComponent(\"v-multiselect\");\n\n  const _component_m_button = _resolveComponent(\"m-button\");\n\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createCommentVNode(\" Dialog thêm mới \"), _createElementVNode(\"div\", {\n    class: _normalizeClass([\"m-popup\", {\n      show: $data.isShow\n    }]),\n    ref: \"categoryDialog\"\n  }, [_createElementVNode(\"div\", _hoisted_1, [_createCommentVNode(\" Header \"), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", null, [_createElementVNode(\"div\", _hoisted_3, _toDisplayString($data.titleForm), 1\n  /* TEXT */\n  )]), _createElementVNode(\"div\", null, [_createElementVNode(\"div\", {\n    class: \"popup-close m-icon m-icon-24 m-close\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.hide && $options.hide(...args))\n  })])]), _createCommentVNode(\" Header end\"), _createCommentVNode(\" Form \"), _createElementVNode(\"div\", _hoisted_4, [_createCommentVNode(\" Detail \"), $data.editMode != 'QuickAdd' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createVNode(_component_m_input, {\n    ref: \"categoryName\",\n    labelText: _ctx.$t('category.category_name'),\n    modelValue: $data.currentItem.category_name,\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.currentItem.category_name = $event),\n    onKeyup: _withKeys($options.saveCategory, [\"enter\"])\n  }, null, 8\n  /* PROPS */\n  , [\"labelText\", \"modelValue\", \"onKeyup\"])])) : _createCommentVNode(\"v-if\", true), $data.editMode == 'QuickAdd' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_createVNode(_component_m_label, {\n    text: \"Tìm danh mục\"\n  }), _createVNode(_component_v_multiselect, {\n    ref: \"categoryList\",\n    mode: \"tags\",\n    modelValue: $data.categoryValue,\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.categoryValue = $event),\n    options: $data.storeCategory,\n    label: \"label\",\n    \"close-on-select\": true,\n    clearOnSelect: true,\n    searchable: true,\n    placeholder: \"Bấm vào để tìm kiếm\",\n    noResultsText: \"Không có dữ liệu hiển thị\",\n    canClear: false,\n    canDeselect: false,\n    onSelect: $options.comboCategorySelected,\n    onDeselect: $options.comboCategoryDeSelected\n  }, null, 8\n  /* PROPS */\n  , [\"modelValue\", \"options\", \"onSelect\", \"onDeselect\"]), $data.editMode == 'QuickAdd' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [_hoisted_8, _createElementVNode(\"span\", {\n    class: \"quick-add-text\",\n    onClick: _cache[3] || (_cache[3] = (...args) => $options.changeModeAdd && $options.changeModeAdd(...args))\n  }, \"Tạo mới\")])) : _createCommentVNode(\"v-if\", true)])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" Detail end\"), _createCommentVNode(\" Footer \"), _createElementVNode(\"div\", _hoisted_9, [_createElementVNode(\"div\", _hoisted_10, [$data.editMode != 'QuickAdd' ? (_openBlock(), _createBlock(_component_m_button, {\n    key: 0,\n    text: _ctx.$t('Save'),\n    class: \"w-full\",\n    onClick: $options.saveCategory\n  }, null, 8\n  /* PROPS */\n  , [\"text\", \"onClick\"])) : _createCommentVNode(\"v-if\", true), $data.editMode == 'QuickAdd' ? (_openBlock(), _createBlock(_component_m_button, {\n    key: 1,\n    text: _ctx.$t('category.add_button'),\n    class: \"w-full\",\n    onClick: $options.sendToPost\n  }, null, 8\n  /* PROPS */\n  , [\"text\", \"onClick\"])) : _createCommentVNode(\"v-if\", true)])]), _createCommentVNode(\" Footer end\")]), _createCommentVNode(\" Form end \")])], 2\n  /* CLASS */\n  )], 2112\n  /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */\n  );\n}","map":{"version":3,"mappings":";;;;;EAGSA,KAAK,EAAC;;;EAEJA,KAAK,EAAC;;;EAEAA,KAAK,EAAC;;;EAQZA,KAAK,EAAC;;;;EAEJA,KAAK,EAAC;;;;EAQNA,KAAK,EAAC;;;;EAkBJA,KAAK,EAAC;;;iDAA+C;;;EAOvDA,KAAK,EAAC;;;EACJA,KAAK,EAAC;;;;;;;;;;;6DAlDhBC,0CACHC,oBAoEM,KApEN,EAoEM;IApEDF,KAAK,mBAAC,SAAD,EAAU;MAAAG,MAAuBC;IAAvB,CAAV,EAoEJ;IApE+CC,GAAG,EAAC;EAoEnD,CApEN,GACEH,oBAkEM,KAlEN,cAkEM,CAjEJD,+BAiEI,EAhEJC,oBAOM,KAPN,cAOM,CANJA,oBAEM,KAFN,EAEM,IAFN,EAEM,CADFA,oBAAiD,KAAjD,cAAiDI,iBAAjBF,eAAiB,CAAjD,EAAyC;EAAA;EAAzC,CACE,CAFN,CAMI,EAHJF,oBAEM,KAFN,EAEM,IAFN,EAEM,CADFA,oBAAsE,KAAtE,EAAsE;IAAjEF,KAAK,EAAC,sCAA2D;IAAnBO,OAAK,yCAAEC,uCAAF;EAAc,CAAtE,CACE,CAFN,CAGI,CAPN,CAgEI,EAxDJP,kCAwDI,EAvDJA,6BAuDI,EAtDJC,oBAoDM,KApDN,cAoDM,CAnDJD,+BAmDI,EAlD8BG,kBAAQ,4BAA1CK,oBAOM,KAPN,cAOM,CANFC,aAKEC,kBALF,EAKE;IAJAN,GAAG,EAAC,cAIJ;IAHCO,SAAS,EAAEC,QAAE,wBAAF,CAGZ;gBAFST,kBAAYU,aAErB;+DAFSV,kBAAYU,gBAAaC,OAElC;IADCC,OAAK,YAAQR,qBAAR,EAAoB,SAApB;EACN,CALF;;EAAA,yCAME,CAPN,sCAkDI,EA1C8BJ,kBAAQ,4BAA1CK,oBAqBM,KArBN,cAqBM,CApBJC,aAA+BO,kBAA/B,EAA+B;IAAtBC,IAAI,EAAC;EAAiB,CAA/B,CAoBI,EAnBJR,aAeES,wBAfF,EAeE;IAdAd,GAAG,EAAC,cAcJ;IAbAe,IAAI,EAAC,MAaL;gBAZShB,mBAYT;+DAZSA,sBAAaW,OAYtB;IAXCM,OAAO,EAAEjB,mBAWV;IAVAkB,KAAK,EAAC,OAUN;IATC,mBAAiB,IASlB;IARCC,aAAa,EAAE,IAQhB;IAPCC,UAAU,EAAE,IAOb;IANAC,WAAW,EAAC,qBAMZ;IALAC,aAAa,EAAC,2BAKd;IAJCC,QAAQ,EAAE,KAIX;IAHCC,WAAW,EAAE,KAGd;IAFCC,QAAM,EAAErB,8BAET;IADCsB,UAAQ,EAAEtB;EACX,CAfF;;EAAA,sDAmBI,EAHgCJ,kBAAQ,4BAA5CK,oBAEM,KAFN,cAEM,aADHP,oBAAkE,MAAlE,EAAkE;IAA5DF,KAAK,EAAC,gBAAsD;IAApCO,OAAK,yCAAEC,yDAAF;EAA+B,CAAlE,EAAoD,SAApD,CACG,CAFN,sCAGI,CArBN,sCA0CI,EApBJP,kCAoBI,EAlBJA,+BAkBI,EAjBJC,oBAeM,KAfN,cAeM,CAdJA,oBAaM,KAbN,eAaM,CAXME,kBAAQ,4BADlB2B,aAKEC,mBALF,EAKE;UAAA;IAHGd,IAAI,EAAEL,QAAE,MAAF,CAGT;IAFEb,KAAK,EAAC,QAER;IADGO,OAAK,EAAEC;EACV,CALF;;EAAA,2DAYI,EALMJ,kBAAQ,4BADlB2B,aAKEC,mBALF,EAKE;UAAA;IAHGd,IAAI,EAAEL,QAAE,qBAAF,CAGT;IAFEb,KAAK,EAAC,QAER;IADGO,OAAK,EAAEC;EACV,CALF;;EAAA,2DAMI,CAbN,CAcI,CAfN,CAiBI,EADJP,kCACI,CApDN,CAsDI,EADJA,iCACI,CAlEN,EADF;;EAAA","names":["class","_createCommentVNode","_createElementVNode","show","$data","ref","_toDisplayString","onClick","$options","_createElementBlock","_createVNode","_component_m_input","labelText","_ctx","category_name","$event","onKeyup","_component_m_label","text","_component_v_multiselect","mode","options","label","clearOnSelect","searchable","placeholder","noResultsText","canClear","canDeselect","onSelect","onDeselect","_createBlock","_component_m_button"],"sourceRoot":"","sources":["D:\\Traveller\\Traveller-Frontend\\traveller-ui\\src\\views\\category\\CategoryDetail.vue"],"sourcesContent":["<template>\r\n     <!-- Dialog thêm mới -->\r\n  <div class=\"m-popup\" v-bind:class=\"{ show: isShow }\" ref=\"categoryDialog\">\r\n    <div class=\"m-popup-box\">\r\n      <!-- Header -->\r\n      <div class=\"m-popup-header\">\r\n        <div>\r\n            <div class=\"popup-title-text\">{{titleForm}}</div>              \r\n        </div>\r\n        <div>          \r\n            <div class=\"popup-close m-icon m-icon-24 m-close\" @click=\"hide\"></div>            \r\n        </div>\r\n      </div>\r\n      <!-- Header end-->\r\n      <!-- Form -->\r\n      <div class=\"m-popup-body\">\r\n        <!-- Detail -->\r\n        <div class=\"form-container\" v-if=\"editMode!='QuickAdd'\">\r\n            <m-input \r\n              ref=\"categoryName\"\r\n              :labelText=\"$t('category.category_name')\"\r\n              v-model=\"currentItem.category_name\"\r\n              @keyup.enter=\"saveCategory\"\r\n            />\r\n        </div>\r\n        <div class=\"form-container\" v-if=\"editMode=='QuickAdd'\">\r\n          <m-label text=\"Tìm danh mục\" />                    \r\n          <v-multiselect\r\n            ref=\"categoryList\"\r\n            mode=\"tags\"\r\n            v-model=\"categoryValue\"\r\n            :options=\"storeCategory\"\r\n            label=\"label\"\r\n            :close-on-select=\"true\"\r\n            :clearOnSelect=\"true\"\r\n            :searchable=\"true\"\r\n            placeholder=\"Bấm vào để tìm kiếm\"\r\n            noResultsText=\"Không có dữ liệu hiển thị\"                                  \r\n            :canClear=\"false\"\r\n            :canDeselect=\"false\"\r\n            @select=\"comboCategorySelected\"\r\n            @deselect=\"comboCategoryDeSelected\"\r\n          />\r\n          <div class=\"quick-add-action\" v-if=\"editMode=='QuickAdd'\">Không tìm thấy danh mục?\r\n             <span class=\"quick-add-text\" @click=\"changeModeAdd\">Tạo mới</span>\r\n          </div>\r\n        </div>\r\n        <!-- Detail end-->\r\n\r\n        <!-- Footer -->\r\n        <div class=\"footer-container flex-grow\">\r\n          <div class=\"footer-line\">\r\n            <m-button \r\n                v-if=\"editMode!='QuickAdd'\"\r\n                :text=\"$t('Save')\" \r\n                class=\"w-full\"                                 \r\n                @click=\"saveCategory\"\r\n            />\r\n            <m-button \r\n                v-if=\"editMode=='QuickAdd'\"\r\n                :text=\"$t('category.add_button')\" \r\n                class=\"w-full\"                                 \r\n                @click=\"sendToPost\"\r\n            />            \r\n          </div>\r\n        </div>\r\n        <!-- Footer end-->\r\n      </div>\r\n      <!-- Form end -->\r\n    </div>\r\n  </div>  \r\n</template>\r\n\r\n<script>\r\nimport CategoryAPI from \"@/api/CategoryAPI\"\r\n//multi vue 3\r\nimport vMultiselect from \"@vueform/multiselect\";\r\nimport \"@vueform/multiselect/themes/default.css\";\r\nexport default {\r\n  components:{\r\n    /* eslint-disable vue/no-unused-components */\r\n    \"v-multiselect\": vMultiselect,\r\n  },\r\n    data() {\r\n        return {\r\n            isShow: false,\r\n            currentItem: {},\r\n            titleForm: this.$t('category.add'),\r\n            editMode: 'Add',\r\n            storeCategory:[],\r\n            categoryValue: null,\r\n            openFromPost: false,\r\n        }\r\n    },\r\n    created(){\r\n      this.initData();\r\n    },\r\n    methods:{\r\n        initData(){\r\n          this.currentItem = {};\r\n          this.categoryValue = null;\r\n          this.titleForm = this.$t('category.add');\r\n          this.editMode = 'Add';\r\n        },\r\n\r\n        async saveCategory(){\r\n          let me = this;\r\n          try {\r\n            let method = 'POST';\r\n            if(me.editMode == 'Edit') method = 'PUT';\r\n            if(!await me.validate()) return;\r\n            let res = await CategoryAPI.request(CategoryAPI.urlName, method, me.currentItem);\r\n            if(res && res.data){\r\n              if(res.data.StatusCode == 201){\r\n                if(!me.openFromPost){\r\n                  me.$store.commit(\"showSuccess\", {message: me.$t(\"message.success_add\")});\r\n                }\r\n                me.afterSave(res.data.Data);\r\n              }else if(res.data.StatusCode == 200){\r\n                me.$store.commit(\"showSuccess\", {message: me.$t(\"message.success\")});\r\n                me.afterSave();\r\n              }\r\n            }\r\n          } catch (error) {\r\n            console.error(error);\r\n          }\r\n        },\r\n\r\n        async validate(){\r\n          let me = this;\r\n          if(!me.currentItem.category_name){\r\n             if(me.$refs.categoryName && typeof me.$refs.categoryName.focus == \"function\"){\r\n              me.$refs.categoryName.focus();\r\n             }\r\n             me.$store.commit(\"showError\", {message: \"Tên danh mục không được bỏ trống.\"});\r\n             return false;\r\n          }\r\n          return true;\r\n        },\r\n\r\n        hide(){\r\n            this.isShow = false;\r\n            this.initData();\r\n        },\r\n\r\n        show(){\r\n          this.isShow = true;\r\n          this.editMode = 'Add'; //mặc định gọi vào hàm này là thêm mới\r\n          this.focusFirstControl();\r\n        },\r\n\r\n        /**\r\n         * show form thêm nhanh , tìm kiếm tại form thêm bài viết\r\n         */\r\n        showQuickAdd(){\r\n            this.editMode = 'QuickAdd';\r\n            this.isShow = true;            \r\n            this.$nextTick(()=>{\r\n              if(this.$refs.categoryList && this.$refs.categoryList.$el && typeof this.$refs.categoryList.$el.focus == \"function\"){\r\n                // this.$refs.categoryList.$el.focus(); //tạm thời ko focus vì auto xổ combo xấu quá\r\n              }\r\n            })\r\n            this.titleForm = this.$t('category.quick_add');\r\n            //lấy dữ liệu danh mục\r\n            if(!this.storeCategory || this.storeCategory.length == 0){\r\n              this.getCategoryData();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Hàm xử lý binding lên khi sửa\r\n         */\r\n        bindingData(listData){          \r\n          let me = this;\r\n          debugger\r\n          if(listData && listData.length > 0){\r\n             this.categoryValue = null;\r\n             this.categoryValue = listData.map(x=>x.category_id);\r\n          }\r\n        },\r\n\r\n        comboCategorySelected(option){\r\n            // this.storeCategory.push(option);\r\n        },\r\n\r\n        comboCategoryDeSelected(option){\r\n            // this.storeCategory.splice(this.storeCategory.indexOf(option),1);\r\n        },\r\n\r\n        /**\r\n         * Hàm lấy dữ lệu danh mục\r\n         */\r\n        async getCategoryData(){\r\n            let res = await CategoryAPI.request(CategoryAPI.urlName, 'GET');\r\n            if(res && res.data){              \r\n              if(res.data.length > 0){\r\n                this.categoryOriginData = res.data;\r\n                this.storeCategory = [];\r\n                for(let i = 0 ; i< res.data.length ; i++){\r\n                  this.storeCategory.push({\r\n                    label: res.data[i].category_name,\r\n                    value: res.data[i].category_id,\r\n                  })\r\n                }\r\n                //lưu cache để tránh gọi nhiều lần\r\n                //todo\r\n              }              \r\n            }\r\n        },\r\n\r\n        /**\r\n         * Gửi giá trị được chọn tới bài viết\r\n         */\r\n        sendToPost(){\r\n           debugger                      \r\n           let listObject = this.categoryOriginData.filter(x=>this.categoryValue.includes(x.category_id)); //tìm ra các bản ghi trùng id, do hiện tại value chỉ chứa mỗi id\r\n           this.$emit(\"changeValue\", listObject);\r\n           this.isShow = false;\r\n        },\r\n\r\n        focusFirstControl(){\r\n            this.$nextTick(()=>{\r\n              if(this.$refs.categoryName && typeof this.$refs.categoryName.focus == \"function\"){\r\n                this.$refs.categoryName.focus();\r\n              }\r\n            })\r\n        },\r\n\r\n        afterSave(callbackData){\r\n          this.hide();\r\n          if(this.openFromPost){//nếu là mở từ form bài viết\r\n               this.$emit(\"changeValue\", [callbackData]);\r\n          }else{\r\n            this.$parent.loadData();\r\n          }\r\n        },\r\n\r\n        showEdit(object){\r\n          let me = this;\r\n          me.editMode = 'Edit';\r\n          me.titleForm = me.$t('category.edit');\r\n          if(object){            \r\n            me.currentItem = JSON.parse(JSON.stringify(object));\r\n            me.isShow = true;\r\n            me.focusFirstControl();\r\n          }\r\n        },\r\n\r\n        /**\r\n         * Chuyển sang mode thêm mới\r\n         */\r\n        changeModeAdd(){\r\n            let me = this;\r\n            me.editMode = 'Add';\r\n            me.titleForm = me.$t('category.add');  \r\n            me.$nextTick(()=>{\r\n              me.$refs.categoryName.focus();\r\n            });\r\n            me.openFromPost = true;\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n@import url(\"/src/style/common/dialog.css\");\r\n.quick-add-action{\r\n  color: #000;\r\n  margin-right: 9px;\r\n  text-align: center;\r\n  margin-top: 10px;\r\n}\r\n\r\n.quick-add-action .quick-add-text{\r\n  color: var(--default-color);\r\n  text-decoration: underline;\r\n  font-weight: 400;\r\n  cursor: pointer;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import AuthAPI from \"@/api/AuthAPI\";\nexport default {\n  name: \"LoginPage\",\n\n  data() {\n    return {\n      currentItem: {},\n      //đối tuont57 để\n      formType: 1,\n      //mặc định là đăng ký,\n      formTitle: this.$t(\"Login\"),\n      showSocial: false,\n      //có show cục tài khoản mạng xã hội hay không?\n      minute: 14,\n      second: 59,\n      minuteString: \"\",\n      secondString: \"\"\n    };\n  },\n\n  created() {\n    let me = this;\n    me.countDown();\n\n    if (me.checkAlreadyLogin()) {\n      me.$router.push({\n        name: \"post\"\n      });\n    }\n  },\n\n  methods: {\n    /**\r\n     * Hàm yêu cầu gửi lại mã xác nhận\r\n     */\n    async resendOTP() {\n      let me = this;\n      me.$commonFunc.load();\n      let object = {\n        email: me.currentItem.email,\n        password: me.currentItem.password\n      };\n\n      try {\n        let res = await AuthAPI.request(AuthAPI.urlName + \"/resend_otp\", \"POST\", object);\n\n        if (res && res.data) {\n          if (res.data.StatusCode == 200) {\n            me.$store.commit(\"showInfo\", {\n              message: \"Mã xác nhận đã gửi lại thành công. Vui lòng kiểm tra email của bạn.\"\n            });\n            me.countDown(); //countdown lại\n          } else if (res.data.DevMsg) {\n            me.$store.commit(\"showInfo\", {\n              message: res.data.DevMsg\n            });\n          }\n        }\n      } catch (error) {\n        console.error(error);\n        me.$commonFunc.unload();\n      }\n\n      me.$commonFunc.unload();\n    },\n\n    /**\r\n    * Hàm tạo đồng hồ đếm ngược thời gian hết hạn của mã xác nhận.\r\n    * @created : quyetkaito 09/10/2022\r\n    */\n    countDown(time) {\n      this.minute = time ? time : 14; //mặc định countdown 15 phút\n\n      this.second = 59;\n      this.minuteString = this.minute + \"\";\n      this.secondString = this.second + \"\";\n      setInterval(() => {\n        this.second = this.second - 1;\n\n        if (this.second <= 0) {\n          this.minute -= 1;\n          this.second = 59;\n        }\n\n        if (this.minute <= 0) return; //hết thời gian\n\n        this.minuteString = this.minute.toString();\n        this.secondString = this.second.toString();\n        if (this.minuteString.length < 2) this.minuteString = \"0\" + this.minute;\n        if (this.secondString.length < 2) this.secondString = \"0\" + this.second;\n      }, 1000);\n    },\n\n    gotoLogin() {\n      this.formType = 1;\n      this.formTitle = this.$t(\"Login\"); //focus vào ô email\n\n      this.$nextTick(() => {\n        this.$refs.email.focus();\n      });\n    },\n\n    /**\r\n     * chuyển sang màn hình đăng ký\r\n     * @created : quyetkaito 08/10/2022\r\n     */\n    gotoRegister() {\n      let me = this;\n      this.formType = 2;\n      this.formTitle = this.$t(\"register.RegisterNewAccount\"); //focus vào ô email\n\n      this.$nextTick(() => {\n        this.$refs.email.focus();\n      });\n    },\n\n    checkAlreadyLogin() {\n      let me = this;\n\n      if (me.$cache.get(\"AccessToken\") != null) {\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\r\n     * Quay lại trang chủ, ko muốn đăng nhập đăng ký gì nữa\r\n     * @created : quyetkaito 02/10/2022\r\n     */\n    backToHome() {\n      this.$router.push({\n        name: \"LandingPage\"\n      });\n    },\n\n    /**------------------------------------------\r\n    * Hàm xử lý khi button Login được Click\r\n    * Author: quyetkaito (22/05/2022)\r\n    --------------------------------------------*/\n    buttonClick(action) {\n      switch (action) {\n        case \"Login\":\n          this.login();\n          break;\n\n        case \"Register\":\n          this.register();\n          break;\n\n        case \"Active\":\n          this.activeAccount();\n          break;\n\n        case \"ResendOTP\":\n          this.resendOTP();\n          break;\n\n        default:\n          break;\n      }\n    },\n\n    /**\r\n     * Hàm thực hiện kích hoạt tài khoản người dùng.\r\n     * @created : quyetkaito 08/10/2022\r\n     */\n    async activeAccount() {\n      let me = this;\n      let object = {\n        email: me.currentItem.email,\n        password: me.currentItem.password,\n        active_code: me.currentItem.otp_code\n      };\n      let res = await AuthAPI.request(AuthAPI.urlName + \"/active_user\", \"POST\", object);\n\n      if (res) {\n        if (res.data.StatusCode == 200) {\n          me.$store.commit(\"showSuccess\", {\n            message: \"Tài khoản đã được kích hoạt thành công. Vui lòng đăng nhập lại.\"\n          });\n          me.formType = 1;\n          me.formTitle = me.$t(\"Login\");\n          me.$nextTick(() => {\n            me.$refs.email.focus();\n          });\n        } else {\n          me.$store.commit(\"showError\", {\n            message: \"Mã xác nhận không chính xác. Vui lòng kiểm tra lại.\"\n          });\n          me.$refs.otp_code.focus();\n          me.$refs.otp_code.addRedBorder();\n        }\n      }\n    },\n\n    async login() {\n      let me = this; //validate\n\n      if (me.validateComponent()) {\n        //gọi api login\n        let object = {\n          email: me.currentItem.email,\n          password: me.currentItem.password\n        };\n\n        try {\n          let res = await AuthAPI.login(object);\n\n          if (res) {\n            if (res.token) {\n              //lấy token lưu vào accesstoken\n              me.$cache.remove(\"AccessToken\");\n              me.$cache.set(\"AccessToken\", res.token);\n\n              if (res.account) {\n                if (res.account.refresh_token) {\n                  me.$cache.remove(\"RefreshToken\");\n                  me.$cache.set(\"RefreshToken\", res.account.refresh_token);\n                }\n\n                me.$session.set(\"FullName\", res.account.full_name);\n              }\n\n              me.$router.push({\n                name: \"post\"\n              });\n            } else {\n              me.$store.commit(\"showError\", {\n                message: \"Tài khoản hoặc mật khẩu không chính xác.\"\n              });\n              me.$nextTick(() => {\n                me.$refs.email.focus();\n              });\n            }\n          } else {\n            me.$store.commit(\"showError\", {\n              message: \"Tài khoản hoặc mật khẩu không chính xác.\"\n            });\n            me.$refs.email.focus();\n          }\n        } catch (error) {\n          console.error(error); // me.handleException(error);\n        } //lưu vào localstorage\n\n      }\n    },\n\n    validateComponent() {\n      let me = this;\n\n      if (me.currentItem) {\n        if (!me.currentItem.email) {\n          if (me.$refs.email && typeof me.$refs.email.addRedBorder == \"function\") {\n            me.$refs.email.addRedBorder();\n            me.$refs.email.focus();\n            me.$store.commit(\"showError\", {\n              message: \"Email/tài khoản không được bỏ trống\"\n            });\n            return false;\n          }\n        }\n\n        if (me.currentItem.email && !me.$commonFunc.validateEmail(me.currentItem.email)) {\n          if (me.$refs.email && typeof me.$refs.email.addRedBorder == \"function\") {\n            me.$refs.email.addRedBorder();\n            me.$refs.email.focus();\n            me.$store.commit(\"showError\", {\n              message: \"Email không hợp lệ\"\n            });\n            return false;\n          }\n        }\n\n        if (!me.currentItem.password) {\n          if (me.$refs.password && typeof me.$refs.password.addRedBorder == \"function\") {\n            me.$refs.password.addRedBorder();\n            me.$refs.password.focus();\n            me.$store.commit(\"showError\", {\n              message: \"Mật khẩu không được bỏ trống\"\n            });\n            return false;\n          }\n        }\n      }\n\n      return true;\n    },\n\n    /**\r\n    * Hàm xử lý cho người dùng đăng ký tài khoản\r\n    * @created : quyetkaito 09/10/2022\r\n    */\n    async register() {\n      let me = this; //validate\n\n      if (me.validateComponent()) {\n        //gọi api login\n        let object = {\n          email: me.currentItem.email,\n          password: me.currentItem.password\n        };\n        me.$commonFunc.load();\n        let res = await AuthAPI.request(AuthAPI.urlName + \"/register\", \"POST\", object);\n\n        if (res) {\n          if (res.data && res.data.StatusCode == 200) {\n            //chuyển sang màn hình nhập mã\n            me.formTitle = \"Kích hoạt tài khoản\";\n            me.formType = 3;\n            me.countDown();\n          } else if (res.data.UserMsg) {\n            me.$store.commit(\"showWarning\", {\n              message: res.data.UserMsg\n            });\n          }\n        } else {\n          me.$store.commit(\"showError\", {\n            message: \"Tài khoản hoặc mật khẩu không chính xác.\"\n          });\n          me.$refs.email.focus();\n        }\n\n        me.$commonFunc.unload();\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["AuthAPI","name","data","currentItem","formType","formTitle","$t","showSocial","minute","second","minuteString","secondString","created","me","countDown","checkAlreadyLogin","$router","push","methods","resendOTP","$commonFunc","load","object","email","password","res","request","urlName","StatusCode","$store","commit","message","DevMsg","error","console","unload","time","setInterval","toString","length","gotoLogin","$nextTick","$refs","focus","gotoRegister","$cache","get","backToHome","buttonClick","action","login","register","activeAccount","active_code","otp_code","addRedBorder","validateComponent","token","remove","set","account","refresh_token","$session","full_name","validateEmail","UserMsg"],"sourceRoot":"","sources":["D:\\Traveller\\Traveller-Frontend\\traveller-ui\\src\\views\\login\\LoginPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"loginpage\">\r\n    <!-- logo -->\r\n    <div class=\"login-top-content flex justify-center h-1/4\">\r\n      <div class=\"flex-col\">\r\n        <div class=\"flex justify-center mb-1\">\r\n          <img\r\n            src=\"@/assets/logo-law.png\"\r\n            alt=\"logo\"\r\n            width=\"100\"\r\n            height=\"100\"\r\n          />\r\n        </div>\r\n        <!-- tên app -->\r\n        <div\r\n          class=\"appname font-medium text-2xl justify-center flex text-white\"\r\n        >\r\n          Traveller\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"login-bottom-content flex justify-center\">\r\n      <!-- Form đăng nhập -->\r\n      <div class=\"warp-form m-card flex flex-col\">\r\n        <div class=\"form-title-text\">{{ formTitle }} {{ minuteString }}:{{ secondString }}</div>\r\n        <div class=\"wrap-form-body\">\r\n          <div class=\"social\" v-if=\"showSocial\">\r\n            <div class=\"social-description\">\r\n              {{$t('login.use_social_account')}}\r\n            </div>\r\n            <div class=\"social-items flex flex-col\">\r\n              <button class=\"btn social-item google h-11\">\r\n                <span class=\"btn-content\">\r\n                  <img\r\n                    src=\"@/assets/logo-law.png\"\r\n                    alt=\"google-icon\"\r\n                    width=\"20\"\r\n                    height=\"30\"\r\n                  />\r\n                  <span class=\"social-item-name\">Connect with Google</span>\r\n                </span>\r\n              </button>\r\n              <button class=\"btn social-item h-11 facebook\">\r\n                <span class=\"social-item-name\"> Connect with Facebook </span>\r\n              </button>\r\n              <button class=\"btn social-item h-11 apple\">\r\n                <span class=\"social-item-name\">Sign in with Apple</span>\r\n              </button>\r\n              <button class=\"btn social-item h-11 apple\" @click=\"backToHome\">\r\n                <span class=\"social-item-name\">Quay lại trang chủ</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div class=\"network\" v-if=\"formType == 1\">\r\n            <div class=\"using-ml-account-text\">{{$t('login.use_traveller_account')}}</div>\r\n            <form class=\"form-auth\">\r\n              <m-input\r\n                ref=\"email\"\r\n                :showLabel=\"false\"\r\n                placeholder=\"Email\"\r\n                v-model=\"currentItem.email\"\r\n                class=\"mb-3 caret-red\"\r\n                :height=\"44\"\r\n              ></m-input>\r\n\r\n              <m-input\r\n                ref=\"password\"\r\n                :showLabel=\"false\"\r\n                placeholder=\"Password\"\r\n                v-model=\"currentItem.password\"\r\n                type=\"password\"\r\n                class=\"mb-2 caret-red\"\r\n                :height=\"44\"\r\n              ></m-input>\r\n\r\n              <div class=\"forgot-password\">\r\n                <span class=\"forgot-password-text\">{{\r\n                  $t(\"ForgotPassword\")\r\n                }}</span>\r\n              </div>\r\n              <button\r\n                class=\"btn-submit-ml btn\"\r\n                type=\"button\"\r\n                @click=\"buttonClick('Login')\"\r\n              >\r\n                <span class=\"btn-content\">{{ $t(\"Login\") }}</span>\r\n              </button>\r\n            </form>\r\n            <div class=\"suggestion\">\r\n              {{ $t(\"NoAccount\") }}\r\n              <span class=\"suggestion-action\" @click=\"gotoRegister\">{{\r\n                $t(\"Register\")\r\n              }}</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"network\" v-if=\"formType == 2\">\r\n            <!-- <div class=\"using-ml-account-text\">Nhập thông tin đăng ký</div> -->\r\n            <form class=\"form-auth\">\r\n              <m-input\r\n                ref=\"email\"\r\n                labelText=\"Nhập email\"\r\n                placeholder=\"Email\"\r\n                v-model=\"currentItem.email\"\r\n                class=\"mb-3 caret-red\"\r\n                :height=\"44\"\r\n              ></m-input>\r\n\r\n              <m-input\r\n                ref=\"password\"\r\n                labelText=\"Nhập mật khẩu\"\r\n                placeholder=\"Password\"\r\n                type=\"password\"\r\n                v-model=\"currentItem.password\"\r\n                class=\"mb-2 caret-red\"\r\n                :height=\"44\"\r\n              ></m-input>\r\n\r\n              <button\r\n                class=\"btn-submit-ml btn mt-2 h-10\"\r\n                type=\"button\"\r\n                @click=\"buttonClick('Register')\"\r\n              >\r\n                <span class=\"btn-content\">{{ $t(\"Register\") }}</span>\r\n              </button>\r\n            </form>\r\n            <div class=\"suggestion\">\r\n              {{ $t(\"AlreadyHasAccount\") }}\r\n              <span class=\"suggestion-action\" @click=\"gotoLogin\">{{\r\n                $t(\"Login\")\r\n              }}</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"network\" v-if=\"formType == 3\">\r\n            <div class=\"using-ml-account-text\">\r\n              Mã kích hoạt đã được gửi tới email <b>{{ currentItem.email }}</b>. Vui\r\n              lòng kiểm tra và nhập mã kích hoạt. Mã có hiệu lực trong :\r\n              {{ minuteString }}:{{ secondString }}\r\n            </div>\r\n            <form class=\"form-auth\">\r\n              <m-input\r\n                ref=\"otp\"\r\n                labelText=\"Nhập mã kích hoạt\"\r\n                placeholder=\"OTP\"\r\n                v-model=\"currentItem.otp_code\"\r\n                class=\"mb-3 caret-red\"\r\n                :height=\"44\"\r\n              ></m-input>\r\n\r\n              <button\r\n                class=\"btn-submit-ml btn mt-2 h-10\"\r\n                type=\"button\"\r\n                @click=\"buttonClick('Active')\"\r\n              >\r\n                <span class=\"btn-content\">{{ $t(\"Active\") }}</span>\r\n              </button>\r\n            </form>\r\n            <div class=\"suggestion\">\r\n              {{ $t(\"NoOTPReceipt\") }}\r\n              <span class=\"suggestion-action\" @click=\"buttonClick('ResendOTP')\">{{\r\n                $t(\"ResendOTP\")\r\n              }}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport AuthAPI from \"@/api/AuthAPI\";\r\nexport default {\r\n  name: \"LoginPage\",\r\n  data() {\r\n    return {\r\n      currentItem: {}, //đối tuont57 để\r\n      formType: 1, //mặc định là đăng ký,\r\n      formTitle: this.$t(\"Login\"),\r\n      showSocial: false, //có show cục tài khoản mạng xã hội hay không?\r\n      minute: 14,\r\n      second: 59,\r\n      minuteString: \"\",\r\n      secondString: \"\",\r\n    };\r\n  },\r\n  created() {\r\n    let me = this;\r\n    me.countDown();\r\n    if (me.checkAlreadyLogin()) {\r\n      me.$router.push({ name: \"post\" });\r\n    }\r\n  },\r\n  methods: {\r\n    /**\r\n     * Hàm yêu cầu gửi lại mã xác nhận\r\n     */\r\n    async resendOTP(){\r\n        let me = this;\r\n        me.$commonFunc.load();\r\n        let object = {\r\n          email: me.currentItem.email,\r\n          password: me.currentItem.password\r\n        }\r\n        try {\r\n          let res = await AuthAPI.request(\r\n            AuthAPI.urlName + \"/resend_otp\",\r\n            \"POST\",\r\n            object\r\n          );\r\n          if(res && res.data){\r\n              if(res.data.StatusCode == 200){\r\n                me.$store.commit(\"showInfo\",{ message : \"Mã xác nhận đã gửi lại thành công. Vui lòng kiểm tra email của bạn.\"}); \r\n                me.countDown(); //countdown lại\r\n              }else if(res.data.DevMsg){\r\n                me.$store.commit(\"showInfo\", {message : res.data.DevMsg});\r\n              }\r\n          }\r\n        } catch (error) {\r\n          console.error(error);\r\n          me.$commonFunc.unload();   \r\n        }\r\n        \r\n        \r\n        me.$commonFunc.unload();\r\n    },\r\n\r\n    /**\r\n    * Hàm tạo đồng hồ đếm ngược thời gian hết hạn của mã xác nhận.\r\n    * @created : quyetkaito 09/10/2022\r\n    */\r\n    countDown(time) {\r\n      this.minute = time? time: 14; //mặc định countdown 15 phút\r\n      this.second = 59;\r\n      this.minuteString = this.minute+\"\";\r\n      this.secondString = this.second+\"\";\r\n      setInterval(() => {        \r\n        this.second = this.second - 1;\r\n        if (this.second <= 0) {\r\n          this.minute -= 1;\r\n          this.second = 59;\r\n        }\r\n        if (this.minute <= 0) return; //hết thời gian\r\n        this.minuteString = this.minute.toString();\r\n        this.secondString = this.second.toString();\r\n        if(this.minuteString.length <2) this.minuteString = \"0\" + this.minute;\r\n        if(this.secondString.length <2) this.secondString = \"0\" + this.second;\r\n      }, 1000);\r\n    },\r\n\r\n    gotoLogin() {\r\n      this.formType = 1;\r\n      this.formTitle = this.$t(\"Login\");\r\n      //focus vào ô email\r\n      this.$nextTick(() => {\r\n        this.$refs.email.focus();\r\n      });\r\n    },\r\n\r\n    /**\r\n     * chuyển sang màn hình đăng ký\r\n     * @created : quyetkaito 08/10/2022\r\n     */\r\n    gotoRegister() { \r\n      let me = this;     \r\n      this.formType = 2;\r\n      this.formTitle = this.$t(\"register.RegisterNewAccount\");\r\n      //focus vào ô email\r\n      this.$nextTick(() => {\r\n        this.$refs.email.focus();\r\n      });            \r\n    },\r\n\r\n    checkAlreadyLogin() {\r\n      let me = this;\r\n      if (me.$cache.get(\"AccessToken\") != null) {\r\n        return true;\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Quay lại trang chủ, ko muốn đăng nhập đăng ký gì nữa\r\n     * @created : quyetkaito 02/10/2022\r\n     */\r\n    backToHome() {\r\n      this.$router.push({ name: \"LandingPage\" });\r\n    },\r\n    /**------------------------------------------\r\n    * Hàm xử lý khi button Login được Click\r\n    * Author: quyetkaito (22/05/2022)\r\n    --------------------------------------------*/\r\n    buttonClick(action) {\r\n      switch (action) {\r\n        case \"Login\":\r\n          this.login();\r\n          break;\r\n        case \"Register\":\r\n          this.register();\r\n          break;\r\n        case \"Active\":\r\n          this.activeAccount();\r\n          break;\r\n        case \"ResendOTP\":\r\n          this.resendOTP();\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Hàm thực hiện kích hoạt tài khoản người dùng.\r\n     * @created : quyetkaito 08/10/2022\r\n     */\r\n    async activeAccount() {\r\n      let me = this;\r\n      let object = {\r\n        email: me.currentItem.email,\r\n        password: me.currentItem.password,\r\n        active_code: me.currentItem.otp_code,\r\n      };\r\n      let res = await AuthAPI.request(\r\n        AuthAPI.urlName + \"/active_user\",\r\n        \"POST\",\r\n        object\r\n      );\r\n      if (res) {\r\n        if (res.data.StatusCode == 200) {\r\n          me.$store.commit(\"showSuccess\", {\r\n            message:\r\n              \"Tài khoản đã được kích hoạt thành công. Vui lòng đăng nhập lại.\",\r\n          });\r\n          me.formType = 1;\r\n          me.formTitle = me.$t(\"Login\");\r\n          me.$nextTick(() => {\r\n            me.$refs.email.focus();\r\n          });\r\n        }else{\r\n          me.$store.commit(\"showError\", {\r\n            message:\r\n              \"Mã xác nhận không chính xác. Vui lòng kiểm tra lại.\",\r\n          });\r\n          me.$refs.otp_code.focus();\r\n          me.$refs.otp_code.addRedBorder();\r\n        }\r\n      }\r\n    },\r\n\r\n    async login() {\r\n      let me = this;\r\n      //validate\r\n      if (me.validateComponent()) {\r\n        //gọi api login\r\n        let object = {\r\n          email: me.currentItem.email,\r\n          password: me.currentItem.password,\r\n        };\r\n        try {\r\n          let res = await AuthAPI.login(object);\r\n          if (res) {\r\n            if (res.token) {\r\n              //lấy token lưu vào accesstoken\r\n              me.$cache.remove(\"AccessToken\");\r\n              me.$cache.set(\"AccessToken\", res.token);\r\n              if (res.account) {\r\n                if (res.account.refresh_token) {\r\n                  me.$cache.remove(\"RefreshToken\");\r\n                  me.$cache.set(\"RefreshToken\", res.account.refresh_token);\r\n                }\r\n                me.$session.set(\"FullName\", res.account.full_name);\r\n              }\r\n              me.$router.push({ name: \"post\" });\r\n            } else {\r\n              me.$store.commit(\"showError\", {\r\n                message: \"Tài khoản hoặc mật khẩu không chính xác.\",\r\n              });\r\n              me.$nextTick(() => {\r\n                me.$refs.email.focus();\r\n              });\r\n            }\r\n          } else {\r\n            me.$store.commit(\"showError\", {\r\n              message: \"Tài khoản hoặc mật khẩu không chính xác.\",\r\n            });\r\n            me.$refs.email.focus();\r\n          }\r\n        } catch (error) {\r\n          console.error(error);\r\n          // me.handleException(error);\r\n        }\r\n\r\n        //lưu vào localstorage\r\n      }\r\n    },\r\n\r\n    validateComponent() {\r\n      let me = this;\r\n      if (me.currentItem) {\r\n        if (!me.currentItem.email) {\r\n          if (\r\n            me.$refs.email &&\r\n            typeof me.$refs.email.addRedBorder == \"function\"\r\n          ) {\r\n            me.$refs.email.addRedBorder();\r\n            me.$refs.email.focus();\r\n            me.$store.commit(\"showError\", {\r\n              message: \"Email/tài khoản không được bỏ trống\",\r\n            });\r\n            return false;\r\n          }\r\n        }\r\n        if (\r\n          me.currentItem.email &&\r\n          !me.$commonFunc.validateEmail(me.currentItem.email)\r\n        ) {\r\n          if (\r\n            me.$refs.email &&\r\n            typeof me.$refs.email.addRedBorder == \"function\"\r\n          ) {\r\n            me.$refs.email.addRedBorder();\r\n            me.$refs.email.focus();\r\n            me.$store.commit(\"showError\", { message: \"Email không hợp lệ\" });\r\n            return false;\r\n          }\r\n        }\r\n        if (!me.currentItem.password) {\r\n          if (\r\n            me.$refs.password &&\r\n            typeof me.$refs.password.addRedBorder == \"function\"\r\n          ) {\r\n            me.$refs.password.addRedBorder();\r\n            me.$refs.password.focus();\r\n            me.$store.commit(\"showError\", {\r\n              message: \"Mật khẩu không được bỏ trống\",\r\n            });\r\n            return false;\r\n          }\r\n        }        \r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n    * Hàm xử lý cho người dùng đăng ký tài khoản\r\n    * @created : quyetkaito 09/10/2022\r\n    */\r\n    async register() {\r\n      let me = this;\r\n      //validate\r\n      if (me.validateComponent()) {\r\n        //gọi api login\r\n        let object = {\r\n          email: me.currentItem.email,\r\n          password: me.currentItem.password,\r\n        };\r\n        me.$commonFunc.load();\r\n        let res = await AuthAPI.request(\r\n          AuthAPI.urlName + \"/register\",\r\n          \"POST\",\r\n          object\r\n        );\r\n        if (res) {\r\n          if (res.data && res.data.StatusCode == 200) {\r\n            //chuyển sang màn hình nhập mã\r\n            me.formTitle = \"Kích hoạt tài khoản\";\r\n            me.formType = 3;\r\n            me.countDown();            \r\n          }else if(res.data.UserMsg){\r\n            me.$store.commit(\"showWarning\", {\r\n              message: res.data.UserMsg,\r\n            });\r\n          }\r\n        } else {\r\n          me.$store.commit(\"showError\", {\r\n            message: \"Tài khoản hoặc mật khẩu không chính xác.\",\r\n          });\r\n          me.$refs.email.focus();\r\n        }\r\n        me.$commonFunc.unload();\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.appname {\r\n  font-weight: 500;\r\n  font-size: 40px;\r\n}\r\n.loginpage {\r\n  width: 100%;\r\n  height: 100vh;\r\n  background: linear-gradient(#00710f 314px, #ebebeb -100%);\r\n}\r\n.login-top-content {\r\n  padding-top: 20px;\r\n}\r\n.login-bottom-content {\r\n  /* background-color: #ebebeb; */\r\n  /* @apply h-3/4; */\r\n}\r\n.warp-form {\r\n  background-color: #fff;\r\n  border-radius: 20px;\r\n  width: 670px;\r\n  padding: 34px 40px 40px;\r\n}\r\n.wrap-form-body {\r\n  display: flex;\r\n  align-items: flex-start;\r\n  align-content: flex-start;\r\n  margin-top: 34px;\r\n}\r\n.form-title-text {\r\n  @apply font-bold text-4xl text-center;\r\n}\r\n.social {\r\n  position: relative;\r\n  overflow: hidden;\r\n  max-width: 280px;\r\n  width: 100%;\r\n  margin-right: 14px;\r\n}\r\n.social-description {\r\n  color: #707070;\r\n  margin-bottom: 18px;\r\n}\r\n.network {\r\n  flex: 1 1 auto;\r\n}\r\n.wrap-form-body .social-item {\r\n  border-radius: 10px !important;\r\n  border: 2px solid !important;\r\n  width: 100% !important;\r\n  padding: 8px 16px !important;\r\n  letter-spacing: normal !important;\r\n  justify-content: center !important;\r\n  text-transform: unset !important;\r\n  background-color: #fff !important;\r\n  margin-bottom: 12px !important;\r\n}\r\n.google {\r\n  color: #fa5d5d !important;\r\n}\r\n.google:hover {\r\n  background-color: #fa5d5d !important;\r\n}\r\n\r\n.wrap-form-body .social-item-name {\r\n  line-height: 19px;\r\n  font-size: 16px;\r\n  margin-left: 14px !important;\r\n}\r\n.wrap-form-body .social-item:hover .social-item-name {\r\n  color: #fff !important;\r\n}\r\n.wrap-form-body .network .using-ml-account-text {\r\n  color: #707070;\r\n  margin-bottom: 18px !important;\r\n  margin-left: 16px !important;\r\n}\r\n.wrap-form-body .network .suggestion {\r\n  color: #000;\r\n  margin-right: 9px;\r\n  text-align: center;\r\n}\r\n.wrap-form-body .network .suggestion-action {\r\n  color: var(--default-color);\r\n  text-decoration: underline;\r\n  font-weight: 400;\r\n  cursor: pointer;\r\n}\r\n.form-auth {\r\n  border-left: 2px solid #e0e0e0;\r\n  padding-left: 14px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-bottom: 16px;\r\n}\r\n.forgot-password {\r\n  text-align: right;\r\n  margin-bottom: 16px;\r\n}\r\n.forgot-password-text {\r\n  color: var(--default-color);\r\n}\r\n.forgot-password-text:hover {\r\n  color: var(--hover-color);\r\n  cursor: pointer;\r\n}\r\n.btn-submit-ml {\r\n  border-radius: 10px !important;\r\n  background-color: #00bc2a !important;\r\n  color: #fff !important;\r\n  font-size: 16px !important;\r\n  cursor: pointer;\r\n}\r\n.h-52 {\r\n  height: 52px !important;\r\n}\r\n.facebook {\r\n  color: #1877f2 !important;\r\n}\r\n.facebook:hover {\r\n  background-color: #1877f2 !important;\r\n}\r\n.apple {\r\n  color: #000;\r\n}\r\n.apple:hover {\r\n  background-color: #000 !important;\r\n}\r\n</style>\r\n\r\n"]},"metadata":{},"sourceType":"module"}
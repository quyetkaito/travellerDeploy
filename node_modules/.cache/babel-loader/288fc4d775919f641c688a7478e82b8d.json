{"ast":null,"code":"import AuthAPI from \"@/api/AuthAPI\";\nexport default {\n  name: \"LoginPage\",\n\n  data() {\n    return {\n      currentItem: {},\n      //đối tuont57 để\n      formType: 1,\n      //1 là đăng nhập, 2 là đăng ký, 3 là màn hình kích hoạt tài khoản, 4 là màn hình quên mật khẩu\n      formTitle: this.$t(\"Login\"),\n      showSocial: false,\n      //có show cục tài khoản mạng xã hội hay không?\n      minute: 14,\n      second: 59,\n      minuteString: \"\",\n      secondString: \"\"\n    };\n  },\n\n  created() {\n    let me = this;\n\n    if (me.checkAlreadyLogin()) {\n      me.$router.push({\n        name: \"post\"\n      });\n    }\n  },\n\n  methods: {\n    /**\r\n    * Chuyển sang màn hình quên mật khẩu\r\n    * @created : quyetkaito 10/10/2022\r\n    */\n    gotoForgotPassword() {\n      this.formType = 4; //chuyển sang màn quên mật khẩu\n\n      this.formTitle = this.$t('forgot_password.GetPasswordBack');\n    },\n\n    /**\r\n     * Hàm yêu cầu gửi lại mã xác nhận\r\n     */\n    async resendOTP() {\n      let me = this;\n      me.$commonFunc.load();\n      let object = {\n        email: me.currentItem.email,\n        password: me.currentItem.password\n      };\n\n      try {\n        let res = await AuthAPI.request(AuthAPI.urlName + \"/resend_otp\", \"POST\", object);\n\n        if (res && res.data) {\n          if (res.data.StatusCode == 200) {\n            me.$store.commit(\"showInfo\", {\n              message: \"Mã xác nhận đã gửi lại thành công. Vui lòng kiểm tra email của bạn.\"\n            });\n            me.countDown(15); //countdown lại\n          } else if (res.data.DevMsg) {\n            me.$store.commit(\"showInfo\", {\n              message: res.data.DevMsg\n            });\n          }\n        }\n      } catch (error) {\n        console.error(error);\n        me.$commonFunc.unload();\n      }\n\n      me.$commonFunc.unload();\n    },\n\n    /**\r\n    * Hàm tạo đồng hồ đếm ngược thời gian hết hạn của mã xác nhận.\r\n    * @created : quyetkaito 09/10/2022\r\n    * @param {Number} time : 15 phút => countdown từ 14:59\r\n    */\n    countDown(time) {\n      this.minute = time ? time - 1 : 14; //mặc định countdown 15 phút\n\n      this.second = 59;\n      this.minuteString = this.minute.toString().length < 2 ? \"0\" + this.minute.toString() : this.minute.toString();\n      this.secondString = this.second + \"\";\n      setInterval(() => {\n        this.second = this.second - 1;\n\n        if (this.second <= 0) {\n          this.minute -= 1;\n          this.second = 59;\n        }\n\n        if (this.minute < 0) {\n          this.minuteString = \"00\";\n          this.secondString = \"00\";\n          return;\n        } //hết thời gian\n\n\n        this.minuteString = this.minute.toString();\n        this.secondString = this.second.toString();\n        if (this.minuteString.length < 2) this.minuteString = \"0\" + this.minute;\n        if (this.secondString.length < 2) this.secondString = \"0\" + this.second;\n      }, 1000);\n    },\n\n    /**\r\n    * Chuyển sang màn hình login\r\n    * @created : quyetkaito 10/10/2022\r\n    */\n    gotoLogin() {\n      this.formType = 1;\n      this.formTitle = this.$t(\"Login\"); //focus vào ô email\n\n      this.$nextTick(() => {\n        this.$refs.email.focus();\n      });\n    },\n\n    /**\r\n     * chuyển sang màn hình đăng ký\r\n     * @created : quyetkaito 08/10/2022\r\n     */\n    gotoRegister() {\n      let me = this;\n      this.formType = 2;\n      this.formTitle = this.$t(\"register.RegisterNewAccount\"); //focus vào ô email\n\n      this.$nextTick(() => {\n        this.$refs.email.focus();\n      });\n    },\n\n    checkAlreadyLogin() {\n      let me = this;\n\n      if (me.$cache.get(\"AccessToken\") != null) {\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\r\n     * Quay lại trang chủ, ko muốn đăng nhập đăng ký gì nữa\r\n     * @created : quyetkaito 02/10/2022\r\n     */\n    backToHome() {\n      this.$router.push({\n        name: \"postList\"\n      });\n    },\n\n    /**------------------------------------------\r\n    * Hàm xử lý khi button Login được Click\r\n    * Author: quyetkaito (22/05/2022)\r\n    --------------------------------------------*/\n    buttonClick(action) {\n      switch (action) {\n        case \"Login\":\n          this.login();\n          break;\n\n        case \"Register\":\n          this.register();\n          break;\n\n        case \"Active\":\n          this.activeAccount();\n          break;\n\n        case \"ResendOTP\":\n          this.resendOTP();\n          break;\n\n        case \"GetPasswordBack\":\n          this.forgotPassword();\n          break;\n\n        case \"ConfirmOTP\":\n          this.confirmOTP();\n          break;\n\n        default:\n          break;\n      }\n    },\n\n    confirmOTP() {},\n\n    /**\r\n    * gọi API quên mật khẩu\r\n    * @created : quyetkaito 10/10/2022\r\n    */\n    async forgotPassword() {\n      let me = this;\n\n      if (me.currentItem.email) {\n        me.$commonFunc.load();\n        let res = await AuthAPI.request(`${AuthAPI.urlName}/forgot_password?email=${me.currentItem.email}`, 'GET');\n        me.$commonFunc.unload();\n\n        if (res && res.data) {\n          if (res.data.StatusCode == 200) {\n            this.$store.commit('showInfo', {\n              message: res.data.UserMsg ? res.data.UserMsg : 'Mã xác nhận đã được gửi thành công.'\n            }); //chuyển sang màn nhập mã\n\n            this.formType = 5;\n            this.formTitle = \"Nhập mã xác nhận thay đổi mật khẩu\";\n            this.countDown(15);\n          } else {\n            this.$store.commit('showError', {\n              message: res.data.UserMsg ? res.data.UserMsg : 'Đã có lỗi xảy ra.'\n            });\n          }\n        }\n      }\n    },\n\n    /**\r\n     * Hàm thực hiện kích hoạt tài khoản người dùng.\r\n     * @created : quyetkaito 08/10/2022\r\n     */\n    async activeAccount() {\n      let me = this;\n      let object = {\n        email: me.currentItem.email,\n        password: me.currentItem.password,\n        active_code: me.currentItem.otp_code\n      };\n      me.$commonFunc.load();\n      let res = await AuthAPI.request(AuthAPI.urlName + \"/active_user\", \"POST\", object);\n\n      if (res) {\n        me.$commonFunc.unload();\n\n        if (res.data.StatusCode == 200) {\n          me.$store.commit(\"showSuccess\", {\n            message: \"Tài khoản đã được kích hoạt thành công. Vui lòng đăng nhập lại.\"\n          });\n          me.formType = 1;\n          me.formTitle = me.$t(\"Login\");\n          me.$nextTick(() => {\n            me.$refs.email.focus();\n          });\n        } else {\n          me.$store.commit(\"showError\", {\n            message: \"Mã xác nhận không hợp lệ. Vui lòng kiểm tra lại.\"\n          });\n          me.$refs.otp_code.focus();\n          me.$refs.otp_code.addRedBorder();\n        }\n      }\n\n      me.$commonFunc.unload();\n    },\n\n    /**\r\n     * Hàm xử lý gọi API đăng nhập\r\n     */\n    async login() {\n      let me = this; //validate\n\n      if (me.validateComponent()) {\n        //gọi api login\n        let object = {\n          email: me.currentItem.email,\n          password: me.currentItem.password\n        };\n\n        try {\n          me.$commonFunc.load();\n          let res = await AuthAPI.login(object);\n          me.$commonFunc.unload();\n\n          if (res) {\n            if (res.token) {\n              //lấy token lưu vào accesstoken\n              me.$cache.remove(\"AccessToken\");\n              me.$cache.set(\"AccessToken\", res.token);\n\n              if (res.account) {\n                if (res.account.refresh_token) {\n                  me.$cache.remove(\"RefreshToken\");\n                  me.$cache.set(\"RefreshToken\", res.account.refresh_token);\n                  me.$cache.remove(\"AccessToken\");\n                  me.$cache.set('AccessToken', res.token);\n                }\n\n                me.$session.set(\"FullName\", res.account.full_name);\n                me.$session.set(\"UserID\", res.account.user_id);\n                me.$store.state.userAvatar = res.account.user_avatar_img;\n                me.$session.set(\"UserAvatar\", res.account.user_avatar_img);\n                me.$session.set(\"UserRole\", res.account.role);\n              }\n\n              me.$router.push({\n                name: \"postList\"\n              });\n            } else {\n              me.$store.commit(\"showError\", {\n                message: \"Tài khoản hoặc mật khẩu không chính xác.\"\n              });\n              me.$nextTick(() => {\n                me.$refs.email.focus();\n              });\n            }\n          } else {\n            me.$store.commit(\"showError\", {\n              message: \"Tài khoản hoặc mật khẩu không chính xác.\"\n            });\n            me.$refs.email.focus();\n          }\n        } catch (error) {\n          console.error(error); // me.handleException(error);\n        } //lưu vào localstorage\n\n      }\n    },\n\n    /**\r\n    * Validate trước khi login\r\n    * @created : quyetkaito 12/10/2022\r\n    */\n    validateComponent() {\n      let me = this;\n\n      if (me.currentItem) {\n        if (!me.currentItem.email) {\n          if (me.$refs.email && typeof me.$refs.email.addRedBorder == \"function\") {\n            me.$refs.email.addRedBorder();\n            me.$refs.email.focus();\n            me.$store.commit(\"showError\", {\n              message: \"Email/tài khoản không được bỏ trống\"\n            });\n            return false;\n          }\n        }\n\n        if (me.currentItem.email && !me.$commonFunc.validateEmail(me.currentItem.email)) {\n          if (me.$refs.email && typeof me.$refs.email.addRedBorder == \"function\") {\n            me.$refs.email.addRedBorder();\n            me.$refs.email.focus();\n            me.$store.commit(\"showError\", {\n              message: \"Email không hợp lệ\"\n            });\n            return false;\n          }\n        }\n\n        if (!me.currentItem.password) {\n          if (me.$refs.password && typeof me.$refs.password.addRedBorder == \"function\") {\n            me.$refs.password.addRedBorder();\n            me.$refs.password.focus();\n            me.$store.commit(\"showError\", {\n              message: \"Mật khẩu không được bỏ trống\"\n            });\n            return false;\n          }\n        }\n      }\n\n      return true;\n    },\n\n    /**\r\n    * Hàm xử lý cho người dùng đăng ký tài khoản\r\n    * @created : quyetkaito 09/10/2022\r\n    */\n    async register() {\n      let me = this; //validate\n\n      if (me.validateComponent()) {\n        //gọi api login\n        let object = {\n          email: me.currentItem.email,\n          password: me.currentItem.password\n        };\n        me.$commonFunc.load();\n        let res = await AuthAPI.request(AuthAPI.urlName + \"/register\", \"POST\", object);\n\n        if (res) {\n          if (res.data && res.data.StatusCode == 200) {\n            //chuyển sang màn hình nhập mã\n            me.formTitle = \"Kích hoạt tài khoản\";\n            me.formType = 3;\n            me.countDown(15);\n          } else if (res.data.UserMsg) {\n            me.$store.commit(\"showWarning\", {\n              message: res.data.UserMsg\n            });\n          }\n        } else {\n          me.$store.commit(\"showError\", {\n            message: \"Tài khoản hoặc mật khẩu không chính xác.\"\n          });\n          me.$refs.email.focus();\n        }\n\n        me.$commonFunc.unload();\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["AuthAPI","name","data","currentItem","formType","formTitle","$t","showSocial","minute","second","minuteString","secondString","created","me","checkAlreadyLogin","$router","push","methods","gotoForgotPassword","resendOTP","$commonFunc","load","object","email","password","res","request","urlName","StatusCode","$store","commit","message","countDown","DevMsg","error","console","unload","time","toString","length","setInterval","gotoLogin","$nextTick","$refs","focus","gotoRegister","$cache","get","backToHome","buttonClick","action","login","register","activeAccount","forgotPassword","confirmOTP","UserMsg","active_code","otp_code","addRedBorder","validateComponent","token","remove","set","account","refresh_token","$session","full_name","user_id","state","userAvatar","user_avatar_img","role","validateEmail"],"sourceRoot":"","sources":["D:\\Traveller\\Traveller-Frontend\\traveller-ui\\src\\views\\login\\LoginPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"loginpage\">\r\n    <!-- logo -->\r\n    <div class=\"login-top-content flex justify-center h-1/4\">\r\n      <div class=\"flex-col\">\r\n        <div class=\"flex justify-center mb-1\">\r\n          <img\r\n            src=\"@/assets/logo-law.png\"\r\n            alt=\"logo\"\r\n            width=\"100\"\r\n            height=\"100\"\r\n            @click=\"backToHome\"\r\n          />\r\n        </div>\r\n        <!-- tên app -->\r\n        <div\r\n          class=\"appname font-medium text-2xl justify-center flex text-white\"\r\n        >\r\n          Traveller\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"login-bottom-content flex justify-center\">\r\n      <!-- Form đăng nhập -->\r\n      <div class=\"warp-form m-card flex flex-col\">\r\n        <div class=\"form-title-text\">{{ formTitle }}</div>\r\n        <div class=\"wrap-form-body\">\r\n          <div class=\"social\" v-if=\"showSocial\">\r\n            <div class=\"social-description\">\r\n              {{$t('login.use_social_account')}}\r\n            </div>\r\n            <div class=\"social-items flex flex-col\">\r\n              <button class=\"btn social-item google h-11\">\r\n                <span class=\"btn-content\">\r\n                  <img\r\n                    src=\"@/assets/logo-law.png\"\r\n                    alt=\"google-icon\"\r\n                    width=\"20\"\r\n                    height=\"30\"\r\n                  />\r\n                  <span class=\"social-item-name\">Connect with Google</span>\r\n                </span>\r\n              </button>\r\n              <button class=\"btn social-item h-11 facebook\">\r\n                <span class=\"social-item-name\"> Connect with Facebook </span>\r\n              </button>\r\n              <button class=\"btn social-item h-11 apple\">\r\n                <span class=\"social-item-name\">Sign in with Apple</span>\r\n              </button>\r\n              <button class=\"btn social-item h-11 apple\" @click=\"backToHome\">\r\n                <span class=\"social-item-name\">Quay lại trang chủ</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <!-- Màn hình đăng nhập -->\r\n          <div class=\"network\" v-if=\"formType == 1\">\r\n            <div class=\"using-ml-account-text\">{{$t('login.use_traveller_account')}}</div>\r\n            <form class=\"form-auth\">\r\n              <m-input\r\n                ref=\"email\"\r\n                :showLabel=\"false\"\r\n                placeholder=\"Email\"\r\n                v-model=\"currentItem.email\"\r\n                class=\"mb-3 caret-red\"\r\n                :height=\"44\"\r\n                @keyup.enter=\"buttonClick('Login')\"\r\n              ></m-input>\r\n\r\n              <m-input\r\n                ref=\"password\"\r\n                :showLabel=\"false\"\r\n                placeholder=\"Password\"\r\n                v-model=\"currentItem.password\"\r\n                type=\"password\"\r\n                :viewPassword=\"false\"\r\n                class=\"mb-2 caret-red\"\r\n                :height=\"44\"\r\n                @keyup.enter=\"buttonClick('Login')\"\r\n              ></m-input>\r\n\r\n              <div class=\"forgot-password\">\r\n                <span class=\"forgot-password-text\" @click=\"gotoForgotPassword\">{{\r\n                  $t(\"ForgotPassword\")\r\n                }}</span>\r\n              </div>\r\n              <button\r\n                class=\"btn-submit-ml btn\"\r\n                type=\"button\"\r\n                @click=\"buttonClick('Login')\"\r\n              >\r\n                <span class=\"btn-content\">{{ $t(\"Login\") }}</span>\r\n              </button>\r\n            </form>\r\n            <div class=\"suggestion\">\r\n              {{ $t(\"NoAccount\") }}\r\n              <span class=\"suggestion-action\" @click=\"gotoRegister\">{{\r\n                $t(\"Register\")\r\n              }}</span>\r\n            </div>\r\n          </div>\r\n          <!-- Màn hình đăng ký tài khoản -->\r\n          <div class=\"network register\" v-if=\"formType == 2\">\r\n            <!-- <div class=\"using-ml-account-text\">Nhập thông tin đăng ký</div> -->\r\n            <form class=\"form-auth\">\r\n              <m-input\r\n                ref=\"email\"\r\n                labelText=\"Nhập email\"\r\n                placeholder=\"Email\"\r\n                v-model=\"currentItem.email\"\r\n                class=\"mb-3 caret-red\"\r\n                :height=\"44\"\r\n              ></m-input>\r\n\r\n              <m-input\r\n                ref=\"password\"\r\n                labelText=\"Nhập mật khẩu\"\r\n                placeholder=\"Password\"\r\n                type=\"password\"\r\n                v-model=\"currentItem.password\"\r\n                class=\"mb-2 caret-red\"\r\n                :height=\"44\"\r\n              ></m-input>\r\n\r\n              <button\r\n                class=\"btn-register-ml btn mt-2 h-10\"\r\n                type=\"button\"\r\n                @click=\"buttonClick('Register')\"\r\n              >\r\n                <span class=\"btn-content\">{{ $t(\"Register\") }}</span>\r\n              </button>\r\n            </form>\r\n            <div class=\"suggestion\">\r\n              {{ $t(\"AlreadyHasAccount\") }}\r\n              <span class=\"suggestion-action\" @click=\"gotoLogin\">{{\r\n                $t(\"Login\")\r\n              }}</span>\r\n            </div>\r\n          </div>\r\n          <!-- Màn hình nhập mã kích hoạt tài khoản -->\r\n          <div class=\"network\" v-if=\"formType == 3\">\r\n            <div class=\"using-ml-account-text\">\r\n              Mã kích hoạt đã được gửi tới email <b>{{ currentItem.email }}</b>. Vui\r\n              lòng kiểm tra và nhập mã kích hoạt. Mã có hiệu lực trong :\r\n              {{ minuteString }}:{{ secondString }}\r\n            </div>\r\n            <form class=\"form-auth\">\r\n              <m-input\r\n                ref=\"otp\"\r\n                labelText=\"Nhập mã kích hoạt\"\r\n                placeholder=\"OTP\"\r\n                v-model=\"currentItem.otp_code\"\r\n                class=\"mb-3 caret-red\"\r\n                :height=\"44\"\r\n              ></m-input>\r\n\r\n              <button\r\n                class=\"btn-submit-ml btn mt-2 h-10\"\r\n                type=\"button\"\r\n                @click=\"buttonClick('Active')\"\r\n              >\r\n                <span class=\"btn-content\">{{ $t(\"Active\") }}</span>\r\n              </button>\r\n            </form>\r\n            <div class=\"suggestion\">\r\n              {{ $t(\"NoOTPReceipt\") }}\r\n              <span class=\"suggestion-action\" @click=\"buttonClick('ResendOTP')\">{{\r\n                $t(\"ResendOTP\")\r\n              }}</span>\r\n            </div>\r\n          </div>\r\n          <!-- Màn hình quên mật khẩu -->\r\n          <div class=\"network\" v-if=\"formType == 4\">            \r\n            <form class=\"form-auth\">\r\n              <m-input\r\n                ref=\"email\"\r\n                labelText=\"Nhập email\"\r\n                placeholder=\"Email\"\r\n                v-model=\"currentItem.email\"\r\n                class=\"mb-3 caret-red\"\r\n                :height=\"44\"\r\n              ></m-input>            \r\n\r\n              <button\r\n                class=\"btn-register-ml btn mt-2 h-10\"\r\n                type=\"button\"\r\n                @click=\"buttonClick('GetPasswordBack')\"\r\n              >\r\n                <span class=\"btn-content\">{{ $t(\"forgot_password.GetPasswordBack\") }}</span>\r\n              </button>\r\n            </form>            \r\n          </div>\r\n          <!-- Màn hình nhập mã xác nhận mật khẩu -->\r\n          <div class=\"network\" v-if=\"formType == 5\">\r\n            <div class=\"using-ml-account-text\">\r\n              Mã xác nhận đã được gửi tới email <b>{{ currentItem.email }}</b>. Vui\r\n              lòng kiểm tra và nhập mã kích hoạt. Mã có hiệu lực trong :\r\n              {{ minuteString }}:{{ secondString }}\r\n            </div>\r\n            <form class=\"form-auth\">\r\n              <m-input\r\n                ref=\"otp\"\r\n                labelText=\"Nhập mã xác nhận\"\r\n                placeholder=\"OTP\"\r\n                v-model=\"currentItem.otp_code\"\r\n                class=\"mb-3 caret-red\"\r\n                :height=\"44\"\r\n              ></m-input>\r\n\r\n              <button\r\n                class=\"btn-submit-ml btn mt-2 h-10\"\r\n                type=\"button\"\r\n                @click=\"buttonClick('ChangePassword')\"\r\n              >\r\n                <span class=\"btn-content\">{{ $t(\"forgot_password.ChangePassword\") }}</span>\r\n              </button>\r\n            </form>\r\n            <div class=\"suggestion\">\r\n              {{ $t(\"NoOTPReceipt\") }}\r\n              <span class=\"suggestion-action\" @click=\"buttonClick('ResendOTP')\">{{\r\n                $t(\"ResendOTP\")\r\n              }}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport AuthAPI from \"@/api/AuthAPI\";\r\nexport default {\r\n  name: \"LoginPage\",\r\n  data() {\r\n    return {\r\n      currentItem: {}, //đối tuont57 để\r\n      formType: 1, //1 là đăng nhập, 2 là đăng ký, 3 là màn hình kích hoạt tài khoản, 4 là màn hình quên mật khẩu\r\n      formTitle: this.$t(\"Login\"),\r\n      showSocial: false, //có show cục tài khoản mạng xã hội hay không?\r\n      minute: 14,\r\n      second: 59,\r\n      minuteString: \"\",\r\n      secondString: \"\",\r\n    };\r\n  },\r\n  created() {\r\n    let me = this;\r\n    if (me.checkAlreadyLogin()) {\r\n      me.$router.push({ name: \"post\" });\r\n    }\r\n  },\r\n  methods: {\r\n    /**\r\n    * Chuyển sang màn hình quên mật khẩu\r\n    * @created : quyetkaito 10/10/2022\r\n    */\r\n    gotoForgotPassword(){\r\n        this.formType = 4; //chuyển sang màn quên mật khẩu\r\n        this.formTitle = this.$t('forgot_password.GetPasswordBack');\r\n    },\r\n\r\n    /**\r\n     * Hàm yêu cầu gửi lại mã xác nhận\r\n     */\r\n    async resendOTP(){\r\n        let me = this;\r\n        me.$commonFunc.load();\r\n        let object = {\r\n          email: me.currentItem.email,\r\n          password: me.currentItem.password\r\n        }\r\n        try {\r\n          let res = await AuthAPI.request(\r\n            AuthAPI.urlName + \"/resend_otp\",\r\n            \"POST\",\r\n            object\r\n          );\r\n          if(res && res.data){\r\n              if(res.data.StatusCode == 200){\r\n                me.$store.commit(\"showInfo\",{ message : \"Mã xác nhận đã gửi lại thành công. Vui lòng kiểm tra email của bạn.\"}); \r\n                me.countDown(15); //countdown lại\r\n              }else if(res.data.DevMsg){\r\n                me.$store.commit(\"showInfo\", {message : res.data.DevMsg});\r\n              }\r\n          }\r\n        } catch (error) {\r\n          console.error(error);\r\n          me.$commonFunc.unload();   \r\n        }\r\n        \r\n        \r\n        me.$commonFunc.unload();\r\n    },\r\n\r\n    /**\r\n    * Hàm tạo đồng hồ đếm ngược thời gian hết hạn của mã xác nhận.\r\n    * @created : quyetkaito 09/10/2022\r\n    * @param {Number} time : 15 phút => countdown từ 14:59\r\n    */\r\n    countDown(time) {\r\n      this.minute = time? time - 1: 14; //mặc định countdown 15 phút\r\n      this.second = 59;\r\n      this.minuteString = this.minute.toString().length <2 ? \"0\"+this.minute.toString() : this.minute.toString();\r\n      this.secondString = this.second+\"\";\r\n      setInterval(() => {        \r\n        this.second = this.second - 1;\r\n        if (this.second <= 0) {\r\n          this.minute -= 1;\r\n          this.second = 59;\r\n        }\r\n        if (this.minute < 0) {\r\n          this.minuteString = \"00\";\r\n          this.secondString = \"00\";\r\n          return; \r\n\r\n        } //hết thời gian\r\n        this.minuteString = this.minute.toString();\r\n        this.secondString = this.second.toString();\r\n        if(this.minuteString.length <2) this.minuteString = \"0\" + this.minute;\r\n        if(this.secondString.length <2) this.secondString = \"0\" + this.second;\r\n      }, 1000);\r\n    },\r\n\r\n    /**\r\n    * Chuyển sang màn hình login\r\n    * @created : quyetkaito 10/10/2022\r\n    */\r\n    gotoLogin() {\r\n      this.formType = 1;\r\n      this.formTitle = this.$t(\"Login\");\r\n      //focus vào ô email\r\n      this.$nextTick(() => {\r\n        this.$refs.email.focus();\r\n      });\r\n    },\r\n\r\n    /**\r\n     * chuyển sang màn hình đăng ký\r\n     * @created : quyetkaito 08/10/2022\r\n     */\r\n    gotoRegister() { \r\n      let me = this;     \r\n      this.formType = 2;\r\n      this.formTitle = this.$t(\"register.RegisterNewAccount\");\r\n      //focus vào ô email\r\n      this.$nextTick(() => {\r\n        this.$refs.email.focus();\r\n      });            \r\n    },\r\n\r\n    checkAlreadyLogin() {\r\n      let me = this;\r\n      if (me.$cache.get(\"AccessToken\") != null) {\r\n        return true;\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Quay lại trang chủ, ko muốn đăng nhập đăng ký gì nữa\r\n     * @created : quyetkaito 02/10/2022\r\n     */\r\n    backToHome() {\r\n      this.$router.push({ name: \"postList\" });\r\n    },\r\n\r\n    /**------------------------------------------\r\n    * Hàm xử lý khi button Login được Click\r\n    * Author: quyetkaito (22/05/2022)\r\n    --------------------------------------------*/\r\n    buttonClick(action) {\r\n      switch (action) {\r\n        case \"Login\":\r\n          this.login();\r\n          break;\r\n        case \"Register\":\r\n          this.register();\r\n          break;\r\n        case \"Active\":\r\n          this.activeAccount();\r\n          break;\r\n        case \"ResendOTP\":\r\n          this.resendOTP();\r\n          break;        \r\n        case \"GetPasswordBack\":\r\n          this.forgotPassword();\r\n          break;\r\n        case \"ConfirmOTP\":\r\n          this.confirmOTP();\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    },\r\n\r\n    confirmOTP(){\r\n\r\n    },\r\n\r\n    /**\r\n    * gọi API quên mật khẩu\r\n    * @created : quyetkaito 10/10/2022\r\n    */\r\n    async forgotPassword(){\r\n        let me = this;\r\n        if(me.currentItem.email){\r\n          me.$commonFunc.load();          \r\n          let res = await AuthAPI.request(`${AuthAPI.urlName}/forgot_password?email=${me.currentItem.email}`, 'GET');\r\n          me.$commonFunc.unload();\r\n          if(res && res.data){\r\n            if(res.data.StatusCode == 200){\r\n              this.$store.commit('showInfo', {message: res.data.UserMsg ? res.data.UserMsg : 'Mã xác nhận đã được gửi thành công.'});\r\n              //chuyển sang màn nhập mã\r\n              this.formType = 5;\r\n              this.formTitle = \"Nhập mã xác nhận thay đổi mật khẩu\";\r\n              this.countDown(15);\r\n            }else {\r\n              this.$store.commit('showError', {message: res.data.UserMsg ? res.data.UserMsg : 'Đã có lỗi xảy ra.'});\r\n            }\r\n          }\r\n        }        \r\n    },\r\n\r\n    /**\r\n     * Hàm thực hiện kích hoạt tài khoản người dùng.\r\n     * @created : quyetkaito 08/10/2022\r\n     */\r\n    async activeAccount() {\r\n      let me = this;\r\n      let object = {\r\n        email: me.currentItem.email,\r\n        password: me.currentItem.password,\r\n        active_code: me.currentItem.otp_code,\r\n      };\r\n      me.$commonFunc.load();\r\n      let res = await AuthAPI.request(\r\n        AuthAPI.urlName + \"/active_user\",\r\n        \"POST\",\r\n        object\r\n      );\r\n      if (res) {\r\n        me.$commonFunc.unload();\r\n        if (res.data.StatusCode == 200) {\r\n          me.$store.commit(\"showSuccess\", {\r\n            message:\r\n              \"Tài khoản đã được kích hoạt thành công. Vui lòng đăng nhập lại.\",\r\n          });\r\n          me.formType = 1;\r\n          me.formTitle = me.$t(\"Login\");\r\n          me.$nextTick(() => {\r\n            me.$refs.email.focus();\r\n          });\r\n        }else{\r\n          me.$store.commit(\"showError\", {\r\n            message:\r\n              \"Mã xác nhận không hợp lệ. Vui lòng kiểm tra lại.\",\r\n          });\r\n          me.$refs.otp_code.focus();\r\n          me.$refs.otp_code.addRedBorder();\r\n        }\r\n      }\r\n      me.$commonFunc.unload();\r\n    },\r\n\r\n    /**\r\n     * Hàm xử lý gọi API đăng nhập\r\n     */\r\n    async login() {\r\n      let me = this;\r\n      //validate\r\n      if (me.validateComponent()) {\r\n        //gọi api login\r\n        let object = {\r\n          email: me.currentItem.email,\r\n          password: me.currentItem.password,\r\n        };\r\n        try {\r\n          me.$commonFunc.load();\r\n          let res = await AuthAPI.login(object);\r\n          me.$commonFunc.unload();\r\n          if (res) {\r\n            if (res.token) {\r\n              //lấy token lưu vào accesstoken\r\n              me.$cache.remove(\"AccessToken\");\r\n              me.$cache.set(\"AccessToken\", res.token);\r\n              if (res.account) {\r\n                if (res.account.refresh_token) {\r\n                  me.$cache.remove(\"RefreshToken\");\r\n                  me.$cache.set(\"RefreshToken\", res.account.refresh_token);\r\n                  me.$cache.remove(\"AccessToken\");\r\n                  me.$cache.set('AccessToken', res.token);                \r\n                }\r\n                me.$session.set(\"FullName\", res.account.full_name);\r\n                me.$session.set(\"UserID\", res.account.user_id);\r\n                me.$store.state.userAvatar = res.account.user_avatar_img;\r\n                me.$session.set(\"UserAvatar\", res.account.user_avatar_img);\r\n                me.$session.set(\"UserRole\", res.account.role);\r\n              }\r\n              me.$router.push({ name: \"postList\" });\r\n            } else {\r\n              me.$store.commit(\"showError\", {\r\n                message: \"Tài khoản hoặc mật khẩu không chính xác.\",\r\n              });\r\n              me.$nextTick(() => {\r\n                me.$refs.email.focus();\r\n              });\r\n            }\r\n          } else {\r\n            me.$store.commit(\"showError\", {\r\n              message: \"Tài khoản hoặc mật khẩu không chính xác.\",\r\n            });\r\n            me.$refs.email.focus();\r\n          }\r\n        } catch (error) {\r\n          console.error(error);\r\n          // me.handleException(error);\r\n        }\r\n\r\n        //lưu vào localstorage\r\n      }\r\n    },\r\n\r\n    /**\r\n    * Validate trước khi login\r\n    * @created : quyetkaito 12/10/2022\r\n    */\r\n    validateComponent() {\r\n      let me = this;\r\n      if (me.currentItem) {\r\n        if (!me.currentItem.email) {\r\n          if (\r\n            me.$refs.email &&\r\n            typeof me.$refs.email.addRedBorder == \"function\"\r\n          ) {\r\n            me.$refs.email.addRedBorder();\r\n            me.$refs.email.focus();\r\n            me.$store.commit(\"showError\", {\r\n              message: \"Email/tài khoản không được bỏ trống\",\r\n            });\r\n            return false;\r\n          }\r\n        }\r\n        if (\r\n          me.currentItem.email &&\r\n          !me.$commonFunc.validateEmail(me.currentItem.email)\r\n        ) {\r\n          if (\r\n            me.$refs.email &&\r\n            typeof me.$refs.email.addRedBorder == \"function\"\r\n          ) {\r\n            me.$refs.email.addRedBorder();\r\n            me.$refs.email.focus();\r\n            me.$store.commit(\"showError\", { message: \"Email không hợp lệ\" });\r\n            return false;\r\n          }\r\n        }\r\n        if (!me.currentItem.password) {\r\n          if (\r\n            me.$refs.password &&\r\n            typeof me.$refs.password.addRedBorder == \"function\"\r\n          ) {\r\n            me.$refs.password.addRedBorder();\r\n            me.$refs.password.focus();\r\n            me.$store.commit(\"showError\", {\r\n              message: \"Mật khẩu không được bỏ trống\",\r\n            });\r\n            return false;\r\n          }\r\n        }        \r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n    * Hàm xử lý cho người dùng đăng ký tài khoản\r\n    * @created : quyetkaito 09/10/2022\r\n    */\r\n    async register() {\r\n      let me = this;\r\n      //validate\r\n      if (me.validateComponent()) {\r\n        //gọi api login\r\n        let object = {\r\n          email: me.currentItem.email,\r\n          password: me.currentItem.password,\r\n        };\r\n        me.$commonFunc.load();\r\n        let res = await AuthAPI.request(\r\n          AuthAPI.urlName + \"/register\",\r\n          \"POST\",\r\n          object\r\n        );\r\n        if (res) {\r\n          if (res.data && res.data.StatusCode == 200) {\r\n            //chuyển sang màn hình nhập mã\r\n            me.formTitle = \"Kích hoạt tài khoản\";\r\n            me.formType = 3;\r\n            me.countDown(15);            \r\n          }else if(res.data.UserMsg){\r\n            me.$store.commit(\"showWarning\", {\r\n              message: res.data.UserMsg,\r\n            });\r\n          }\r\n        } else {\r\n          me.$store.commit(\"showError\", {\r\n            message: \"Tài khoản hoặc mật khẩu không chính xác.\",\r\n          });\r\n          me.$refs.email.focus();\r\n        }\r\n        me.$commonFunc.unload();\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.appname {\r\n  font-weight: 500;\r\n  font-size: 40px;\r\n}\r\n.loginpage {\r\n  width: 100%;\r\n  height: 100vh;\r\n  background: linear-gradient(#00710f 314px, #ebebeb -100%);\r\n}\r\n.login-top-content {\r\n  padding-top: 20px;\r\n}\r\n.login-bottom-content {\r\n  /* background-color: #ebebeb; */\r\n  /* @apply h-3/4; */\r\n}\r\n.warp-form {\r\n  background-color: #fff;\r\n  border-radius: 20px;\r\n  width: 670px;\r\n  padding: 34px 40px 40px;\r\n}\r\n.wrap-form-body {\r\n  display: flex;\r\n  align-items: flex-start;\r\n  align-content: flex-start;\r\n  margin-top: 34px;\r\n}\r\n.form-title-text {\r\n  @apply font-bold text-4xl text-center;\r\n}\r\n.social {\r\n  position: relative;\r\n  overflow: hidden;\r\n  max-width: 280px;\r\n  width: 100%;\r\n  margin-right: 14px;\r\n}\r\n.social-description {\r\n  color: #707070;\r\n  margin-bottom: 18px;\r\n}\r\n.network {\r\n  flex: 1 1 auto;\r\n}\r\n.wrap-form-body .social-item {\r\n  border-radius: 10px !important;\r\n  border: 2px solid !important;\r\n  width: 100% !important;\r\n  padding: 8px 16px !important;\r\n  letter-spacing: normal !important;\r\n  justify-content: center !important;\r\n  text-transform: unset !important;\r\n  background-color: #fff !important;\r\n  margin-bottom: 12px !important;\r\n}\r\n.google {\r\n  color: #fa5d5d !important;\r\n}\r\n.google:hover {\r\n  background-color: #fa5d5d !important;\r\n}\r\n\r\n.wrap-form-body .social-item-name {\r\n  line-height: 19px;\r\n  font-size: 16px;\r\n  margin-left: 14px !important;\r\n}\r\n.wrap-form-body .social-item:hover .social-item-name {\r\n  color: #fff !important;\r\n}\r\n.wrap-form-body .network .using-ml-account-text {\r\n  color: #707070;\r\n  margin-bottom: 18px !important;\r\n  margin-left: 16px !important;\r\n}\r\n.wrap-form-body .network .suggestion {\r\n  color: #000;\r\n  margin-right: 9px;\r\n  text-align: center;\r\n}\r\n.wrap-form-body .network .suggestion-action {\r\n  color: var(--default-color);\r\n  text-decoration: underline;\r\n  font-weight: 400;\r\n  cursor: pointer;\r\n}\r\n.form-auth {\r\n  border-left: 2px solid #e0e0e0;\r\n  padding-left: 14px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-bottom: 16px;\r\n}\r\n.forgot-password {\r\n  text-align: right;\r\n  margin-bottom: 16px;\r\n}\r\n.forgot-password-text {\r\n  color: var(--default-color);\r\n}\r\n.forgot-password-text:hover {\r\n  color: var(--hover-color);\r\n  cursor: pointer;\r\n}\r\n.btn-submit-ml {\r\n  border-radius: 10px !important;\r\n  background-color: #00bc2a !important;\r\n  color: #fff !important;\r\n  font-size: 16px !important;\r\n  cursor: pointer;\r\n}\r\n\r\n.btn-register-ml {\r\n  border-radius: 10px !important;\r\n  background-color: #004bbc !important;\r\n  color: #fff !important;\r\n  font-size: 16px !important;\r\n  cursor: pointer;\r\n}\r\n.h-52 {\r\n  height: 52px !important;\r\n}\r\n.facebook {\r\n  color: #1877f2 !important;\r\n}\r\n.facebook:hover {\r\n  background-color: #1877f2 !important;\r\n}\r\n.apple {\r\n  color: #000;\r\n}\r\n.apple:hover {\r\n  background-color: #000 !important;\r\n}\r\n</style>\r\n\r\n"]},"metadata":{},"sourceType":"module"}